<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="enonce"></div>

  <input type="text" id="reponse" placeholder="...">

  <button onclick="verifier()">V√©rifier</button>
  <button onclick="corriger()">Correction</button>
  <button onclick="genererEquation()">Nouvel exercice</button>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
/* ====================== MATHJAX ====================== */
function renderMath(el){
  MathJax.typesetClear([el]);
  MathJax.typesetPromise([el]);
}

/* ====================== OUTILS ====================== */
function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
function nonZero(){ let x; do{x=rand(-6,6);}while(x===0); return x; }

/* ====================== VARIABLES ====================== */
let a,b,c,p;
let m1,p1;
let mFrac;
let pFrac;
let bonneReponse="", explication="";
let eq1Texte="", eq2Texte="";
  
/* ====================== CONSTANTES ====================== */

const PROBA_CONFONDUE   = 0.20;
const PROBA_PARALLELES = 0.20;
const PROBA_PERP       = 0.30;
// le reste = s√©cantes non perpendiculaires

  const ENSEMBLE_M = [
  { num: 2, den: 1 },
  { num: 3, den: 1 },
  { num: 4, den: 1 },
  { num: 5, den: 1 },
  { num: 1, den: 2 },
  { num: 1, den: 3 },
  { num: 1, den: 4 },
  { num: 1, den: 5 },
  { num: 2, den: 3 },
  { num: 2, den: 5 },
  { num: 3, den: 2 },
  { num: 3, den: 4 },
  { num: 3, den: 5 },
  { num: 4, den: 3 },
  { num: 4, den: 5 }
];

/* ====================== FONCTIONS ====================== */

  function randCoeffNZ10(){
  let x;
  do{
    x = Math.floor(Math.random()*21) - 10;
  } while(x === 0 || x === 1 || x === -1); 
  return x;
}

  function tirerDansEnsembleM(){
  const choix = ENSEMBLE_M[Math.floor(Math.random()*ENSEMBLE_M.length)];
  return { num: choix.num, den: choix.den };
}

  function fractionLaTeX(num, den){
  if(den === 1) return num.toString();
  return `\\frac{${num}}{${den}}`;
}

  function fractionsEgales(f1, f2){
  if(!f1 || !f2) return false;
  return f1.num * f2.den === f2.num * f1.den;
}

  function pgcd(x, y){
  x = Math.abs(x);
  y = Math.abs(y);
  while (y !== 0) {
    let t = y;
    y = x % y;
    x = t;
  }
  return x;
}

function fractionIrreductible(num, den){
  const p = pgcd(num, den);
  return {
    num: num / p,
    den: den / p
  };
}

  function normaliserFraction(frac){
  let { num, den } = frac;
  if (den < 0) {
    num = -num;
    den = -den;
  }
  return { num, den };
}

  function fractionAvecSigne(frac) {
  const signe = frac.num < 0 ? '-' : '';
  return signe + fractionLaTeX(Math.abs(frac.num), frac.den);
}

  function afficherMx(frac) {
  // frac est suppos√©e d√©j√† normalis√©e
  if (frac.num === 1 && frac.den === 1) return 'x';
  if (frac.num === -1 && frac.den === 1) return '-x';
  return `${fractionAvecSigne(frac)}x`;
}

  function afficherM(frac) {
  // frac normalis√©e
  if (frac.num === 1 && frac.den === 1) return '1';
  if (frac.num === -1 && frac.den === 1) return '-1';
  return fractionAvecSigne(frac);
}

  function additionFractions(f1, f2){
  return fractionIrreductible(
    f1.num * f2.den + f2.num * f1.den,
    f1.den * f2.den
  );
}

function multiplicationFractions(f1, f2){
  return fractionIrreductible(
    f1.num * f2.num,
    f1.den * f2.den
  );
}

  function ppcm(a, b){
  return Math.abs(a * b) / pgcd(a, b);
}

function ppcmListe(tab){
  return tab.reduce((acc, val) => ppcm(acc, val));
}

  /* ====================== GENERER EQUATION ====================== */

function genererEquation(){

  // ===== Remise √† z√©ro =====
  document.getElementById("feedback").innerHTML = "";


  /* ===== DROITE d1 : ax + by + c = 0 ===== */
  a = randCoeffNZ10();
  b = randCoeffNZ10();
  c = randCoeffNZ10();

  eq1Texte = `${a}x ${b>0?'+':''} ${b}y ${c>0?'+':''} ${c} = 0`
    .replace(/\+\s-/g,'- ');

  // pente et ordonn√©e √† l'origine de d1
m1 = normaliserFraction(fractionIrreductible(-a, b));
p1 = normaliserFraction(fractionIrreductible(-c, b));


  
  /* ===== DROITE d2 : y = mx + p selon le type voulu ===== */

  const r = Math.random();

  if (r < PROBA_CONFONDUE) {
    // === PARALL√àLES CONFONDUES ===
    mFrac = m1;
    pFrac = p1;
    bonneReponse = "confondue";
    explication =`
    Comme les droites ont la m√™me pente \\( (m_1=m_2)\\) et la m√™me ordonn√©e √† l‚Äôorigine \\( (p_1=p_2)\\), 
      les droites sont parall√®les confondues \\((d_1=d_2)\\) et <span style='color: #475a93; font-weight: bold;'> leur intersection est les droites elles-m√™mes  \\( (d_1 \\cap d_2 = d_1 = d_2)\\) </span>.`;
  }

  else if (r < PROBA_CONFONDUE + PROBA_PARALLELES) {
    // === PARALL√àLES DISTINCTES ===
    mFrac = m1;

    do {
      pFrac = tirerDansEnsembleM();
    } while (fractionsEgales(pFrac, p1));
    bonneReponse = "paralleles";
    explication =`
    Comme les droites ont la m√™me pente \\((m_1=m_2)\\) mais des ordonn√©es √† l‚Äôorigine diff√©rentes \\((p_1 \\neq p_2)\\), 
      les droites sont parall√®les distinctes et <span style='color: #475a93; font-weight: bold;'>leur intersection est vide  \\( (d_1 \\cap d_2 = \\varnothing) \\) </span>.`;
}

  else {
    // === S√âCANTES ===
    do {
      mFrac = tirerDansEnsembleM();
    } while (
      fractionsEgales(mFrac, m1) ||
      mFrac.num * m1.num === -mFrac.den * m1.den
    );

    pFrac = tirerDansEnsembleM();
    bonneReponse = "secantes";
    explication =`
    Comme les pentes sont diff√©rentes \\( (m_1 \\neq m_2) \\),  
        les droites sont s√©cantes et <span style='color: #475a93; font-weight: bold;'> leur intersection est un point. </span>.`;
}
  
let pTexte = "";

if (pFrac.num !== 0) {
  pTexte = pFrac.num > 0
    ? ` + ${fractionLaTeX(pFrac.num, pFrac.den)}`
    : ` - ${fractionLaTeX(Math.abs(pFrac.num), pFrac.den)}`;
}

eq2Texte = `y = ${afficherMx(mFrac)}${pTexte}`;




  /* ==================== AFFICHAGE ======================== */
const eqDiv = document.getElementById("enonce");
  eqDiv.innerHTML = `
    La droite \\(d_1\\) a pour √©quation : \\[ ${eq1Texte} \\]<br>
    La droite \\(d_2\\) a pour √©quation : \\[ ${eq2Texte} \\]<br>
    D√©termine l'intersection entre ces deux droites.
  `;
  renderMath(eqDiv);

}

  /* ====================== CORRECTION DETAILLEE ====================== */

function corriger(){
  const f = document.getElementById("feedback");
  f.style.color = "#000";

  // === Calculs propres ===
  const m1Calc = fractionIrreductible(-a, b);
  const p1Calc = fractionIrreductible(-c, b);

  // === Affichage propre (signes normalis√©s) ===
  const m1Aff = normaliserFraction(m1Calc);
  const p1Aff = normaliserFraction(p1Calc);

  const aAbs = Math.abs(a);
  const cAbs = Math.abs(c);
  const absB = Math.abs(b);

  let texte = `
  üìò <strong>Correction d√©taill√©e</strong><br><br>
  <span style='color: var(--peps); font-weight: bold;'> √âtape 1 : </span>  <span style='color: var(--peps)'>r√©duire l‚Äô√©quation de \\(d_1\\) </span> <br>
  `;


  /* ===== CAS b > 0 ===== */
if (b > 0) {

texte += `
\\[
\\begin{aligned}
${eq1Texte.replace('=', '&=')} \\\\
${absB}y &= ${-a}x ${c >= 0 ? '-' : '+'} ${cAbs} \\\\
\\frac{${absB}}{${absB}}y &= ${a >= 0 ? '-' : '+'} \\frac{${aAbs}}{${absB}}x ${c >= 0 ? '-' : '+'} \\frac{${cAbs}}{${absB}}  \\\\
y &= ${afficherMx(m1Aff)}
     ${p1Aff.num >= 0 ? '+' : '-'}
     ${fractionLaTeX(Math.abs(p1Aff.num), p1Aff.den)}
\\end{aligned}
\\]
`;
}


/* ===== CAS b < 0 ===== */
else {

texte += `
\\[
\\begin{aligned}
${eq1Texte.replace('=', '&=')} \\\\
${a}x ${c >= 0 ? '+' : '-'} ${cAbs} &= ${absB}y \\\\
${a >= 0 ? '' : '-'}\\frac{${aAbs}}{${absB}}x ${c >= 0 ? '+' : '-'} \\frac{${cAbs}}{${absB}} &= \\frac{${absB}}{${absB}}y \\\\
y &= ${afficherMx(m1Aff)}
     ${p1Aff.num >= 0 ? '+' : '-'}
     ${fractionLaTeX(Math.abs(p1Aff.num), p1Aff.den)}
\\end{aligned}
\\]
`;
}






  /* ===== √âtape 2 : lecture des coefficients ===== */
  
texte += `
<span style='color: var(--peps); font-weight: bold;'> √âtape 2 : </span>  <span style='color: var(--peps)'> identification des coefficients </span> <br><br>
\\(
m_1 = ${fractionAvecSigne(m1Aff)}, 
\\quad
p_1 = ${fractionAvecSigne(p1Aff)}
\\)<br>

\\(
m_2 = ${afficherM(mFrac)}, 
\\quad
p_2 = ${fractionAvecSigne(pFrac)}
\\)<br><br>

<span style='color: var(--peps); font-weight: bold;'> √âtape 3 : </span>  <span style='color: var(--peps)'> comparaison des coefficients  </span> <br><br>
${explication} <br><br>`;


  if (bonneReponse === "secantes") {

  // d√©nominateur commun
const D = ppcmListe([
  m1Aff.den,
  p1Aff.den,
  mFrac.den,
  pFrac.den
]);

const m1Num = m1Aff.num * (D / m1Aff.den);
const p1Num = p1Aff.num * (D / p1Aff.den);
const m2Num = mFrac.num * (D / mFrac.den);
const p2Num = pFrac.num * (D / pFrac.den);


  // coefficients apr√®s mise au m√™me d√©nominateur
  const A = m1Aff.num * (D / m1Aff.den);
  const B = p1Aff.num * (D / p1Aff.den);
  const C = mFrac.num * (D / mFrac.den);
  const E = pFrac.num * (D / pFrac.den);

  const xNum = E - B;
  const xDen = A - C;
  const xInter = fractionIrreductible(xNum, xDen);

  const yInter = additionFractions(
    multiplicationFractions(mFrac, xInter),
    pFrac
  );

texte += `
<span style='color: var(--peps); font-weight: bold;'> √âtape 4 : </span>
<span style='color: var(--peps)'> calcul du point d‚Äôintersection </span><br><br>

On r√©sout le syst√®me form√© par les deux √©quations :
\\[
\\begin{cases}
\\; y = ${afficherMx(m1Aff)}
${p1Aff.num >= 0 ? '+' : '-'}
${fractionLaTeX(Math.abs(p1Aff.num), p1Aff.den)} \\quad  (d_1) \\\\
\\; y = ${afficherMx(mFrac)}
${pFrac.num >= 0 ? '+' : '-'}
${fractionLaTeX(Math.abs(pFrac.num), pFrac.den)} \\quad  (d_2)
\\end{cases}
\\]

On √©galise les deux expressions de \\(y\\) :<br>
\\(
${afficherMx(m1Aff)}
${p1Aff.num >= 0 ? '+' : '-'}
${fractionLaTeX(Math.abs(p1Aff.num), p1Aff.den)}
=
${afficherMx(mFrac)}
${pFrac.num >= 0 ? '+' : '-'}
${fractionLaTeX(Math.abs(pFrac.num), pFrac.den)}
\\)<br><br>

On met les quatre termes sur le m√™me d√©nominateur :<br>
\\(
\\frac{${m1Num}x}{${D}}
${p1Num >= 0 ? '-' : '+'}
\\frac{${Math.abs(p1Num)}}{${D}}
=
\\frac{${m2Num}x}{${D}}
${p2Num >= 0 ? '+' : '-'}
\\frac{${Math.abs(p2Num)}}{${D}}
\\)<br><br>


On supprime le d√©nominateur commun :<br>
\\(
\\begin{aligned}
${A}x ${B >= 0 ? '+' : ''}${B} &= ${C}x ${E >= 0 ? '+' : ''}${E} \\\\
${A}x - ${C}x &= ${E} - ${B} \\\\
x &= ${fractionLaTeX(xInter.num, xInter.den)}
\\end{aligned}
\\)<br><br>


On remplace dans l‚Äô√©quation de \\(d_2\\) :
\\[
y = ${afficherM(mFrac)} ${fractionLaTeX(xInter.num, xInter.den)}
${pFrac.num >= 0 ? '+' : '-'}
${fractionLaTeX(Math.abs(pFrac.num), pFrac.den)}
\\]

\\[
y = ${fractionLaTeX(yInter.num, yInter.den)}
\\]

<span style="font-weight:bold">
L‚Äôintersection des deux droites est le point
\\(
(${fractionLaTeX(xInter.num,xInter.den)} ; ${fractionLaTeX(yInter.num,yInter.den)})
\\).
</span>
`;

  }

  f.innerHTML = texte;
  renderMath(f);
}


  
/* ====================== VERIFICATION ====================== */
function verifier(){
  const rep = document.getElementById("reponse").value
    .toLowerCase()
    .trim();

  const f = document.getElementById("feedback");

  if (rep === bonneReponse) {
    f.innerHTML = "‚úÖ Bonne r√©ponse !";
    f.style.color = "black";
  } else {
    f.innerHTML = "‚ùå R√©ponse incorrecte";
    f.style.color = "black";
  }

  corriger();
}




window.onload = genererEquation;
</script>

<script src="../../../js/protection.js"></script>
</body>
</html>
