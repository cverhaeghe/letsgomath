<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="enonce"></div>

  <!-- QCM -->
<div id="qcm" class="qcm-grid">

  <div class="qcm-card" data-reponse="confondue"
       onclick="verifier('confondue',this)">
    Parall√®les confondues
  </div>

  <div class="qcm-card" data-reponse="paralleles"
       onclick="verifier('paralleles',this)">
    Parall√®les distinctes
  </div>

  <div class="qcm-card" data-reponse="perpendiculaires"
       onclick="verifier('perpendiculaires',this)">
    Perpendiculaires
  </div>

  <div class="qcm-card" data-reponse="secantes"
       onclick="verifier('secantes',this)">
    S√©cantes non perpendiculaires
  </div>

</div>



  <div class="center-button">
    <button onclick="generer()">Nouvel exercice</button>
  </div>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
/* ====================== MATHJAX ====================== */
function renderMath(el){
  MathJax.typesetClear([el]);
  MathJax.typesetPromise([el]);
}

/* ====================== OUTILS ====================== */
function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
function nonZero(){ let x; do{x=rand(-6,6);}while(x===0); return x; }

/* ====================== VARIABLES ====================== */
let a,b,c,p;
let m1,p1;
let mFrac;
let pFrac;
let bonneReponse="", explication="";
let eq1Texte="", eq2Texte="";
  
/* ====================== CONSTANTES ====================== */


  const ENSEMBLE_M = [
  { num: 0, den: 1 },
  { num: 1, den: 1 },
  { num: 2, den: 1 },
  { num: 3, den: 1 },
  { num: 4, den: 1 },
  { num: 5, den: 1 },
  { num: 1, den: 2 },
  { num: 1, den: 3 },
  { num: 1, den: 4 },
  { num: 1, den: 5 },
  { num: 2, den: 3 },
  { num: 2, den: 5 },
  { num: 3, den: 2 },
  { num: 3, den: 4 },
  { num: 3, den: 5 },
  { num: 4, den: 3 },
  { num: 4, den: 5 }
];

/* ====================== FONCTIONS ====================== */

  function randCoeffNZ10(){
  let x;
  do{
    x = Math.floor(Math.random()*21) - 10;
  } while(x === 0);
  return x;
}

  function tirerDansEnsembleM(){
  const choix = ENSEMBLE_M[Math.floor(Math.random()*ENSEMBLE_M.length)];
  return { num: choix.num, den: choix.den };
}

  function fractionLaTeX(num, den){
  if(den === 1) return num.toString();
  return `\\frac{${num}}{${den}}`;
}

  function fractionsEgales(f1, f2){
  if(!f1 || !f2) return false;
  return f1.num * f2.den === f2.num * f1.den;
}

  function pgcd(x, y){
  x = Math.abs(x);
  y = Math.abs(y);
  while (y !== 0) {
    let t = y;
    y = x % y;
    x = t;
  }
  return x;
}

function fractionIrreductible(num, den){
  const p = pgcd(num, den);
  return {
    num: num / p,
    den: den / p
  };
}

  /* ====================== GENERER EQUATION ====================== */

function genererEquation(){

  // ===== Remise √† z√©ro =====
  document.getElementById("feedback").innerHTML = "";
  document.querySelectorAll('.qcm-card').forEach(card=>{
    card.classList.remove('correct','incorrect');
    card.style.pointerEvents = "auto";
  });

  /* ===== DROITE d1 : ax + by + c = 0 ===== */
  a = randCoeffNZ10();
  b = randCoeffNZ10();
  c = randCoeffNZ10();

  eq1Texte = `${a}x ${b>0?'+':''} ${b}y ${c>0?'+':''} ${c} = 0`
    .replace(/\+\s-/g,'- ');

  /* ===== DROITE d2 : y = mx + p ===== */
  mFrac = tirerDansEnsembleM();
  pFrac = tirerDansEnsembleM();

let pTexte = "";

if (pFrac.num !== 0) {
  pTexte = pFrac.num > 0
    ? ` + ${fractionLaTeX(pFrac.num, pFrac.den)}`
    : ` - ${fractionLaTeX(Math.abs(pFrac.num), pFrac.den)}`;
}

eq2Texte = `y = ${fractionLaTeX(mFrac.num, mFrac.den)}x${pTexte}`;



  /* ==================== AFFICHAGE ======================== */
const eqDiv = document.getElementById("enonce");
  eqDiv.innerHTML = `
    La droite \\(d_1\\) a pour √©quation : \\[ ${eq1Texte} \\]<br>
    La droite \\(d_2\\) a pour √©quation : \\[ ${eq2Texte} \\]<br>
    D√©termine la position relative de ces deux droites.
  `;
  renderMath(eqDiv);

  /* ============== Pr√©paration correction ================ */
  calculerBonneReponse();
}

  /* ====================== CALCUL ====================== */

function calculerBonneReponse(){

  // d1 : ax + by + c = 0
m1 = fractionIrreductible(-a, b);
p1 = fractionIrreductible(-c, b);


  // d2 : y = mx + p
  const m2 = mFrac;
  const p2 = pFrac;

  if (fractionsEgales(m1, m2) && fractionsEgales(p1, p2)) {
    bonneReponse = "confondue";
    explication = "Les deux droites ont la m√™me pente et la m√™me ordonn√©e √† l‚Äôorigine.";
  }
  else if (fractionsEgales(m1, m2)) {
    bonneReponse = "paralleles";
    explication = "Les pentes sont √©gales mais les ordonn√©es √† l‚Äôorigine sont diff√©rentes.";
  }
  else if (m1.num * m2.num === -m1.den * m2.den) {
    bonneReponse = "perpendiculaires";
    explication = "Les pentes sont oppos√©es inverses.";
  }
  else {
    bonneReponse = "secantes";
    explication = "Les pentes sont diff√©rentes et non oppos√©es inverses.";
  }
}


  /* ====================== CORRECTION DETAILLEE ====================== */

function corriger(){
  const m1Red = fractionIrreductible(-a, b);
  const p1Red = fractionIrreductible(-c, b);
  const f = document.getElementById("feedback");
  f.style.color = "#000";

  let texte = `
  üìò <strong>Correction d√©taill√©e</strong><br><br>

  <u>√âtape 1</u> : r√©duire l‚Äô√©quation de \\(d_1\\)<br>
  \\[
    ${eq1Texte}
  \\]<br>
  `;

  /* ===== CAS b > 0 ===== */
if (b > 0) {

const m1Red = fractionIrreductible(-a, b);
const p1Red = fractionIrreductible(-c, b);

texte += `
\\[
\\begin{aligned}
${eq1Texte} \\\\
${b}y &= -${a}x - ${c} \\\\
y &= -\\frac{${a}}{${b}}x - \\frac{${c}}{${b}} \\\\
y &= ${fractionLaTeX(m1Red.num, m1Red.den)}x
     ${p1Red.num >= 0 ? '+' : '-'}
     ${fractionLaTeX(Math.abs(p1Red.num), p1Red.den)}
\\end{aligned}
\\]
`;

}


/* ===== CAS b < 0 ===== */
else {

  const m1Red = fractionIrreductible(a, -b);
  const p1Red = fractionIrreductible(c, -b);

texte += `
\\[
\\begin{aligned}
${eq1Texte} \\\\
${a}x + ${c} &= ${-b}y \\\\
\\frac{${a}}{${-b}}x + \\frac{${c}}{${-b}} &= y \\\\
y &= ${fractionLaTeX(m1Red.num, m1Red.den)}x
     ${p1Red.num >= 0 ? '+' : '-'}
     ${fractionLaTeX(Math.abs(p1Red.num), p1Red.den)}
\\end{aligned}
\\]
`;

}


  /* ===== √âtape 2 : lecture des coefficients ===== */
  
const m1Red = fractionIrreductible(-a, b);
const p1Red = fractionIrreductible(-c, b);

texte += `
<u>√âtape 2 : identification des coefficients</u><br>
√Ä partir de l‚Äô√©quation r√©duite :
\\[
  y = ${fractionLaTeX(m1Red.num, m1Red.den)}x
      ${p1Red.num >= 0 ? '+' : '-'}
      ${fractionLaTeX(Math.abs(p1Red.num), p1Red.den)}
\\]
on lit directement :
\\[
  m_1 = ${fractionLaTeX(m1Red.num, m1Red.den)}, \quad
  p_1 = ${fractionLaTeX(p1Red.num, p1Red.den)}
\\]<br><br>
`;


  <u>√âtape 3 : comparaison</u><br>
  ${explication}
  `;

  f.innerHTML = texte;
  renderMath(f);
}


  
/* ====================== VERIFICATION ====================== */
function verifier(rep, el){
  document.querySelectorAll('.qcm-card')
    .forEach(c => c.style.pointerEvents = "none");

  if(rep === bonneReponse){
    el.classList.add('correct');
  } else {
    el.classList.add('incorrect');

    document.querySelectorAll('.qcm-card').forEach(c => {
      if(c.dataset.reponse === bonneReponse){
        c.classList.add('correct');
      }
    });
  }

    // affichage automatique de la correction
  corriger();
}


window.onload = genererEquation;
</script>

<script src="../../../js/protection.js"></script>
</body>
</html>
