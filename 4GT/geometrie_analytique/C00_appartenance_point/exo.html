<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="enonce"></div>

  <input type="text" id="reponse" placeholder="Oui ou non ?">

  <button onclick="verifier()">V√©rifier</button>
  <button onclick="corriger()">Correction</button>
  <button onclick="generer()">Nouvel exercice</button>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
/* =====================================================
   OUTILS FRACTIONS & MATH
===================================================== */
function pgcd(a,b){
  a=Math.abs(a); b=Math.abs(b);
  while(b!==0){ let t=b; b=a%b; a=t; }
  return a;
}

function fractionIrreductible(num, den){
  if(den<0){ num=-num; den=-den; }
  const p=pgcd(num,den);
  return {num:num/p, den:den/p};
}

function fractionLatex(num, den){
  if(num===0) return "0";
  if(den===1) return num.toString();
  if(num<0) return `-\\frac{${Math.abs(num)}}{${den}}`;
  return `\\frac{${num}}{${den}}`;
}

function valFrac(f){ return f.num/f.den; }

function fractionDansBornes(f){
  return Math.abs(f.num)<=5 && Math.abs(f.den)<=5;
}

function afficheCoordonnee(num, den){
  // entier
  if (den === 1) {
    return num < 0 ? `(${num})` : `${num}`;
  }

  // fraction
  const frac = `\\frac{${Math.abs(num)}}{${den}}`;
  if (num < 0) return `(-${frac})`;
  return frac;
}



  
/* =====================================================
   GENERATEURS DE COEFFICIENTS
===================================================== */
function randIntNonZeroNotOne(){
  let x;
  do{
    x=Math.floor(Math.random()*11)-5;
  }while(x===0||x===1||x===-1);
  return x;
}

function randFractionNotOne(){
  let f;
  do{
    let num,den;
    do{
      num=Math.floor(Math.random()*11)-5;
      den=Math.floor(Math.random()*11)-5;
    }while(num===0||den===0);
    f=fractionIrreductible(num,den);
  }while(Math.abs(f.num)===Math.abs(f.den));
  return f;
}

function randEntierOuFraction(pFrac = 0.4){
  if(Math.random() < pFrac){
    return randFractionNotOne();
  }
  return { num: randIntNonZeroNotOne(), den: 1 };
}
  
function renderMath(el){
  MathJax.typesetClear([el]);
  MathJax.typesetPromise([el]);
}

function termeSigne(coef, contenu){
  if(coef === 0) return "";
  if(coef > 0) return `+ ${coef === 1 ? "" : coef}${contenu}`;
  return `- ${Math.abs(coef) === 1 ? "" : Math.abs(coef)}${contenu}`;
}

function termeConstante(c){
  if(c === 0) return "";
  return c > 0 ? `+ ${c}` : `- ${Math.abs(c)}`;
}

function afficheNombre(n){
  return n < 0 ? `(${n})` : `${n}`;
}

function termeAvecSigne(val){
  if(val === 0) return "0";
  return val > 0 ? `+ ${val}` : `- ${Math.abs(val)}`;
}

function fractionAvecSigne(num, den){
  if(num === 0) return "0";
  const f = `\\frac{${Math.abs(num)}}{${den}}`;
  return num > 0 ? `+ ${f}` : `- ${f}`;
}

/* =====================================================
   VARIABLES
===================================================== */
let appartient=false;
let texteCorrection="";

/* =====================================================
   GENERATION EXERCICE
===================================================== */
function generer(){

  appartient = Math.random() < 0.4; // 40% de oui, 60% de non
  const tirage=Math.random();
  let enonce="";
  let e,f;

/* ===== CAS 1 : y = mx + p ===== */
if(tirage<0.4){

const m = randEntierOuFraction(0.4);
const p = randEntierOuFraction(0.4);


  let essais=0;

  let yF;
do{
  const eF = randEntierOuFraction(0.4);
  e = eF.den === 1 ? eF.num : eF; 
  yF = fractionIrreductible(
  m.num * e * p.den + p.num * m.den,
  m.den * p.den
);
  f = fractionLatex(yF.num, yF.den);
  essais++;
  if(essais>50) break;
} while(appartient && !fractionDansBornes(yF));


  if(!appartient){
    f=Math.floor(Math.random()*7)-3;
  }

  enonce=`
  La droite a pour √©quation :<br>
  \\(y = ${fractionLatex(m.num,m.den)}x
  ${p.num>=0?"+":"-"} ${fractionLatex(Math.abs(p.num),p.den)}\\)<br><br>
  Le point \\(A(${e};${f})\\) appartient-il √† cette droite ?
  `;

  texteCorrection=`
  On teste l'expression \\(y = mx + p\\).<br>
  ${appartient?"L'√©galit√© est v√©rifi√©e.":"L'√©galit√© n'est pas v√©rifi√©e."}
  `;
}

/* ===== CAS 2 : x = k ===== */
else if(tirage<0.6){

  const k = randEntierOuFraction(0.4);
  
  let essais=0;
  f=Math.floor(Math.random()*7)-3;

  let yF;
  do{
  const eF = randEntierOuFraction(0.4);
  e = eF.den === 1 ? eF.num : eF; 
  yF = fractionIrreductible(
  m.num * e * p.den + p.num * m.den,
  m.den * p.den
);
  f = fractionLatex(yF.num, yF.den);
  essais++;
  if(essais>50) break;
} while(appartient && !fractionDansBornes(yF));


  enonce=`
  La droite a pour √©quation :<br>
  \\(x = ${fractionLatex(k.num,k.den)}\\)<br><br>
  Le point \\(A(${e};${f})\\) appartient-il √† cette droite ?
  `;

  texteCorrection=`
  On compare l'abscisse du point √† \\(k\\).<br>
  ${appartient?"Elles sont √©gales.":"Elles sont diff√©rentes."}
  `;
}

/* ===== CAS 3 : ax + by + c = 0 ===== */
else {

  /* --- coefficients a, b, c --- */
  const a = randEntierOuFraction(0.4);
  const b = randEntierOuFraction(0.4);

  let c;
  do {
    c = randEntierOuFraction(0.4);
  } while (c.num === 0);

  /* valeurs num√©riques pour les calculs */
  const aCalc = a.den === 1 ? a.num : a.num / a.den;
  const bCalc = b.den === 1 ? b.num : b.num / b.den;
  const cCalc = c.den === 1 ? c.num : c.num / c.den;

  /* --- g√©n√©ration du point --- */
  let yF;
  let essais = 0;

  do {
    const eF = randEntierOuFraction(0.4);
    e = eF.den === 1 ? eF.num : eF;

    yF = fractionIrreductible(-aCalc * e - cCalc, bCalc);
    f = fractionLatex(yF.num, yF.den);

    essais++;
    if (essais > 50) break;
  } while (appartient && !fractionDansBornes(yF));

  if (!appartient) {
    f = Math.floor(Math.random() * 7) - 3;
  }

  /* --- √©quation affich√©e --- */
  const aAff = a.num;
  const bAff = b.num;
  const cAff = c.num;

  let eq = "";
  eq += (aAff < 0 ? "-" : "") + (Math.abs(aAff) === 1 ? "" : Math.abs(aAff)) + "x";
  eq += " " + (bAff >= 0 ? "+ " : "- ") + (Math.abs(bAff) === 1 ? "" : Math.abs(bAff)) + "y";
  eq += " " + (cAff >= 0 ? "+ " : "- ") + Math.abs(cAff) + " = 0";

  enonce = `
  La droite a pour √©quation :<br>
  \\(${eq}\\)<br><br>
  Le point \\(A(${e};${f})\\) appartient-il √† cette droite ?
  `;

  /* ===== CORRECTION D√âTAILL√âE ===== */

  const yCorr = (typeof f === "string")
    ? yF
    : { num: f, den: 1 };

  let texte = `
<u>√âtape 1</u> : on remplace les coordonn√©es du point \\(A(${e};${f})\\) dans l'√©quation<br>
\\[
${aCalc}\\cdot ${afficheNombre(e)}
${termeAvecSigne(bCalc)}\\cdot ${afficheCoordonnee(yCorr.num, yCorr.den)}
${termeAvecSigne(cCalc)}
\\stackrel{?}{=} 0
\\]
`;

  const ax = aCalc * e;

  let byNum = bCalc * yCorr.num;
  let byDen = yCorr.den;

  let byValeur;
  let resteFraction = false;

  if (byDen === 1) {
    byValeur = byNum;
  } else if (Math.abs(byNum) % byDen === 0) {
    byValeur = byNum / byDen;
  } else {
    byValeur = { num: byNum, den: byDen };
    resteFraction = true;
  }

  texte += `
<u>√âtape 2</u> : on effectue et on simplifie les produits<br>
\\[
${ax}
${
  resteFraction
    ? fractionAvecSigne(byValeur.num, byValeur.den)
    : termeAvecSigne(byValeur)
}
${termeAvecSigne(cCalc)}
\\stackrel{?}{=} 0
\\]
`;

  if (!resteFraction) {

    const somme = ax + byValeur + cCalc;

    texte += `
<u>√âtape 3</u> : on additionne et on compare √† z√©ro<br>
\\[
${somme} ${somme === 0 ? "=" : "\\neq"} 0
\\]
`;

    texte += somme === 0
      ? `<br>üëâ Le point <strong>appartient</strong> √† la droite.`
      : `<br>üëâ Le point <strong>n'appartient pas</strong> √† la droite.`;

  } else {

    const den = byValeur.den;

    texte += `
<u>√âtape 3</u> : il reste une fraction, on met sur le m√™me d√©nominateur<br>
\\[
${fractionAvecSigne(ax * den, den)}
${fractionAvecSigne(byValeur.num, den)}
${fractionAvecSigne(cCalc * den, den)}
\\stackrel{?}{=} 0
\\]
`;

    const numFinal = ax * den + byValeur.num + cCalc * den;

    texte += `
<u>√âtape 4</u> : on additionne les num√©rateurs<br>
\\[
${numFinal === 0 ? "0" : fractionLatex(Math.abs(numFinal), den)}
${numFinal === 0 ? "=" : "\\neq"} 0
\\]
`;

    texte += numFinal === 0
      ? `<br>üëâ Le point <strong>appartient</strong> √† la droite.`
      : `<br>üëâ Le point <strong>n'appartient pas</strong> √† la droite.`;
  }

  texteCorrection = texte;



}


document.getElementById("enonce").innerHTML=enonce;
renderMath(document.getElementById("enonce"));
document.getElementById("reponse").value="";
document.getElementById("feedback").innerHTML="";
}

/* =====================================================
   VERIFICATION
===================================================== */
function verifier(){
  const r=document.getElementById("reponse").value.trim().toLowerCase();
  const f=document.getElementById("feedback");

  if(r!=="oui"&&r!=="non"){
    f.style.color="red";
    f.innerHTML="‚ùå Incorrect";
    return;
  }

  if((r==="oui")===appartient){
    f.style.color="green";
    f.innerHTML="‚úÖ Correct";
  }else{
    f.style.color="red";
    f.innerHTML="‚ùå Incorrect";
  }
}

/* =====================================================
   CORRECTION
===================================================== */
function corriger(){
  const f=document.getElementById("feedback");
  f.style.color="#000";
  f.innerHTML=`üìò <strong>Correction</strong><br><br>${texteCorrection}`;
  renderMath(f);
}

/* =====================================================
   INIT
===================================================== */
generer();
</script>

<script src="../../../js/protection.js"></script>

</body>
</html>
