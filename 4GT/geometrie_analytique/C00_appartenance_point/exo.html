<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<!-- CSS -->
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- MathJax -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="enonce"></div>

  <input type="text" id="reponse" placeholder="Oui ou non ?">

  <button onclick="verifier()">V√©rifier</button>
  <button onclick="corriger()">Correction</button>
  <button onclick="generer()">Nouvel exercice</button>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
/* =====================================================
   OUTILS MATHEMATIQUES
===================================================== */
function pgcd(a, b){
  a = Math.abs(a);
  b = Math.abs(b);
  while(b !== 0){
    let t = b;
    b = a % b;
    a = t;
  }
  return a;
}

function fractionIrreductible(num, den){
  if(den < 0){ num = -num; den = -den; }
  const p = pgcd(num, den);
  return { num: num/p, den: den/p };
}

function fracTex(num, den){
  if(num === 0) return "0";
  if(den === 1) return num.toString();
  return `\\frac{${num}}{${den}}`;
}

function valFrac(f){
  return f.num / f.den;
}

function randIntNonZero(){
  let x;
  do { x = Math.floor(Math.random()*11)-5; }
  while(x === 0);
  return x;
}

function randFraction(){
  let num, den;
  do{
    num = Math.floor(Math.random()*11)-5;
    den = Math.floor(Math.random()*11)-5;
  } while(num === 0 || den === 0);

  return fractionIrreductible(num, den);
}

function renderMath(el){
  MathJax.typesetClear([el]);
  MathJax.typesetPromise([el]);
}

/* =====================================================
   VARIABLES GLOBALES
===================================================== */
let appartient = false;
let texteCorrection = "";

/* =====================================================
   GENERATION DE L'EXERCICE
===================================================== */
function generer(){

  appartient = Math.random() < 0.5;
  const tirage = Math.random();

  let e, f;
  let enonce = "";

  /* ===== CAS 1 : y = mx + p ===== */
  if(tirage < 0.4){

    const m = randFraction();
    const p = randFraction();

    e = randIntNonZero();

    if(appartient){
      const yFrac = fractionIrreductible(
        m.num * e * p.den + p.num * m.den,
        m.den * p.den
      );
      f = fracTex(yFrac.num, yFrac.den);
    } else {
      f = randIntNonZero();
    }

    enonce = `
    La droite a pour √©quation :<br>
    \\(y = ${fracTex(m.num,m.den)}x + ${fracTex(p.num,p.den)}\\)<br><br>
    Le point \\(A(${e};${f})\\) appartient-il √† cette droite ?
    `;

    texteCorrection = `
    On teste l'appartenance :<br>
    \\(y = mx + p\\)<br>
    ${appartient ? "L'√©galit√© est v√©rifi√©e." : "L'√©galit√© n'est pas v√©rifi√©e."}
    `;
  }

  /* ===== CAS 2 : x = k ===== */
  else if(tirage < 0.7){

    const k = randFraction();

    if(appartient){
      e = fracTex(k.num, k.den);
    } else {
      e = randIntNonZero();
    }
    f = randIntNonZero();

    enonce = `
    La droite a pour √©quation :<br>
    \\(x = ${fracTex(k.num,k.den)}\\)<br><br>
    Le point \\(A(${e};${f})\\) appartient-il √† cette droite ?
    `;

    texteCorrection = `
    On remplace x par ${e} :<br>
    ${appartient ? "${e} = k" : "${e} \neq k "}
    `;
  }

  /* ===== CAS 3 : ax + by + c = 0 ===== */
  else {

    const a = randIntNonZero();
    const b = randIntNonZero();
    const c = randIntNonZero();

    e = randIntNonZero();

    if(appartient){
      const yFrac = fractionIrreductible(
        -a*e - c,
        b
      );
      f = fracTex(yFrac.num, yFrac.den);
    } else {
      f = randIntNonZero();
    }

    enonce = `
    La droite a pour √©quation :<br>
    \\(${a}x + ${b}y + ${c} = 0\\)<br><br>
    Le point \\(A(${e};${f})\\) appartient-il √† cette droite ?
    `;

    texteCorrection = `
    On calcule :<br>
    \\(${a}\\times${e} + ${b}\\times${f} + ${c}
    ${appartient ? "= 0" : "\\neq 0"}\\)
    `;
  }

  const div = document.getElementById("enonce");
  div.innerHTML = enonce;
  renderMath(div);

  document.getElementById("reponse").value = "";
  document.getElementById("feedback").innerHTML = "";
}

/* =====================================================
   VERIFICATION
===================================================== */
function verifier(){
  const r = document.getElementById("reponse").value.trim().toLowerCase();
  const fdb = document.getElementById("feedback");

  if(r !== "oui" && r !== "non"){
    fdb.style.color = "red";
    fdb.innerHTML = "‚ùå R√©ponse attendue : oui ou non";
    return;
  }

  if((r === "oui") === appartient){
    fdb.style.color = "green";
    fdb.innerHTML = "‚úÖ Correct";
  } else {
    fdb.style.color = "red";
    fdb.innerHTML = "‚ùå Incorrect";
  }
}

/* =====================================================
   CORRECTION
===================================================== */
function corriger(){
  const fdb = document.getElementById("feedback");
  fdb.style.color = "#000";
  fdb.innerHTML = `üìò <strong>Correction</strong><br><br>${texteCorrection}`;
  renderMath(fdb);
}

/* =====================================================
   INIT
===================================================== */
generer();
</script>

<!-- Protection clic droit -->
<script src="../../../js/protection.js"></script>

</body>
</html>
