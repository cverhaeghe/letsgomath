<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<!-- CSS -->
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- MathJax v3 -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

<div class="equation-box" id="equation"></div>

  <input type="text" id="reponse" placeholder="...">

  <button onclick="verifier()">V√©rifier</button>
  <button onclick="corriger()">R√©solution</button>
  <button onclick="generer()">Nouvel exercice</button>

  <p id="feedback" class="feedback"></p>
  <div id="correction" class="correction"></div>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>


  
<script>
  /*==============VARIABLES========*/
let m, e, f, p;
let cas;
let a, b, c;
  /*==============FONCTIONS========*/

  function randNonZero(min, max) {
  let x;
  do {
    x = Math.floor(Math.random() * (max - min + 1)) + min;
  } while (x === 0);
  return x;
}

  function pgcd(a, b) {
  a = Math.abs(a);
  b = Math.abs(b);
  while (b !== 0) {
    const r = a % b;
    a = b;
    b = r;
  }
  return a;
}

  function fractionIrreductible(a, b) {
  if (b === 0) throw new Error("Division par 0 interdite");

  let num = a;
  let den = b;

  const d = pgcd(num, den);
  num /= d;
  den /= d;

  // normalisation du signe
  if (den < 0) {
    num = -num;
    den = -den;
  }

  return { num, den };
}

  
  function normaliser(str) {
  return str
    .replace(/\s+/g, "")
    .replace(",", ".")
    .toLowerCase();
}

  function termeX(coef) {
  if (coef === 0) return "";
  if (coef === 1) return "x";
  if (coef === -1) return "-x";
  return `${coef}x`;
}

  function termeConstante(c) {
  if (c === 0) return "";
  return c > 0 ? `+${c}` : `${c}`;
}

  function fractionLaTeX(num, den){
  if(den === 1) return num.toString();
  return `\\frac{${num}}{${den}}`;
}

  function Aff(a) {
  if (a === 1) return "";
  if (a === -1) return "-";
  return a.toString();
}


  
function afficherCoefX(frac) {
  const { num, den } = frac;

  if (num === 0) return "";
  if (num === den) return "";
  if (num === -den) return "-";

  if (den === 1) return num.toString();

  const signe = num < 0 ? "-" : "";
  return `${signe}\\frac{${Math.abs(num)}}{${den}}`;
  }

  function afficherConstante(frac) {
  const { num, den } = frac;

  if (num === 0) return "";

  if (den === 1) {
    return num > 0 ? `+${num}` : `${num}`;
  }

  return num > 0
    ? `+\\frac{${num}}{${den}}`
    : `-\\frac{${Math.abs(num)}}{${den}}`;
}

function opposeInverseLatex(frac) {
  let { num, den } = frac;

  // Inversion
  let invNum = den;
  let invDen = num;

  // Oppos√©
  invNum = -invNum;

  // Normalisation du signe
  if (invDen < 0) {
    invNum = -invNum;
    invDen = -invDen;
  }

  // Cas entier
  if (invDen === 1) {
    return invNum.toString();
  }

  // Affichage LaTeX avec signe DEVANT
  const signe = invNum < 0 ? "-" : "";
  return `${signe}\\frac{${Math.abs(invNum)}}{${invDen}}`;
}

  
  function equationCartesienne(a, b, c) {

  let eq = "";

  // --- terme ax ---
  if (a !== 0) {
    if (a === 1) eq += "x";
    else if (a === -1) eq += "-x";
    else eq += `${a}x`;
  }

  // --- terme by ---
  if (b !== 0) {
    if (eq !== "") eq += b > 0 ? " + " : " - ";
    else if (b < 0) eq += "-";

    const absB = Math.abs(b);
    if (absB === 1) eq += "y";
    else eq += `${absB}y`;
  }

  // --- terme constant ---
  if (c !== 0) {
    if (eq !== "") eq += c > 0 ? " + " : " - ";
    else if (c < 0) eq += "-";

    eq += Math.abs(c);
  }

  return eq + " = 0";
}

  function equationReduite(m, p) {

  // Cas particulier : droite verticale (s√©curit√©)
  if (m === null) return "";

  let eq = "y=";

  /* --- terme en x --- */
  if (m !== 0) {
    if (m === 1) eq += "x";
    else if (m === -1) eq += "-x";
    else eq += `${m}x`;
  }

  /* --- terme constant --- */
  if (p !== 0) {
    if (m === 0) {
      // √©viter y=+2
      eq += p;
    } else {
      eq += p > 0 ? `+${p}` : `${p}`;
    }
  }

  /* --- cas m=0 --- */
  if (m === 0 && p !== 0) {
    eq = `y=${p}`;
  }

  return eq;
}


  
/*===============
    GENERATION
================*/
  
function generer() {

  document.getElementById("feedback").innerHTML = "";
  document.getElementById("reponse").value = "";
  document.getElementById("correction").innerHTML = "";
  document.getElementById("correction").style.display = "none";

  const r = Math.random() * 100;

  // Point A
  e = Math.floor(Math.random() * 7) - 3;
  f = Math.floor(Math.random() * 7) - 3;

  let enonce = "";

  /* ===== CAS 1 : parall√®le √† l‚Äôaxe des x (10%) ===== */
  
  if (r < 10) {
    
    cas = 1;

    p = f;
    m = 0;

    enonce = `Calcule l'√©quation r√©duite de la droite <br>
    passant par le point \\(A(${e};${f})\\) et <br>
    parall√®le √† l‚Äôaxe des abscisses.`;

  }

  /* ===== CAS 2 : parall√®le √† l‚Äôaxe des y (10%) ===== */
  else if (r < 20) {

    cas = 2;

    enonce = `Calcule l'√©quation de la droite <br>
    passant par le point \\(A(${e};${f})\\) et <br>
    parall√®le √† l‚Äôaxe des ordonn√©es.`;

    // Cas particulier : x = e
    m = null;
    p = null;
  }

  /* ===== CAS 3 : passant par A et B (30%) ===== */
  else if (r < 50) {

    cas = 3;

    let xB, yB;
    do {
      xB = Math.floor(Math.random() * 7) - 3;
      yB = Math.floor(Math.random() * 7) - 3;
    } while (xB === e);

    m = (yB - f) / (xB - e);
    p = f - m * e;

    enonce = `Calcule l'√©quation r√©duite de la droite \\(AB\\) <br>
    √©tant donn√©  \\(A(${e};${f})\\) et \\(B(${xB};${yB})\\).`;
  }

  /* ===== CAS 4 : parall√®le √† d2 (25%) ===== */
  else if (r < 75) {

    cas = 4;

    a = randNonZero(-5, 5);
    b = randNonZero(-5, 5); 
    c = Math.floor(Math.random() * 11) - 5;


    m = -a / b;
    p = f - m * e;

    enonce = `Calcule l'√©quation r√©duite de la droite \\(d_1\\) <br>
    passant par le point \\(A(${e};${f})\\) et <br>
    parall√®le √† la droite \\(d_2 \\equiv ${equationCartesienne(a, b, c)}\\).`;
  }

  /* ===== CAS 5 : perpendiculaire √† d2 (25%) ===== */
  else {

    cas = 5;

    a = randNonZero(-5, 5);
    b = randNonZero(-5, 5); 
    c = Math.floor(Math.random() * 11) - 5;

    m = b / a;
    p = f - m * e;

    enonce = `Calcule l'√©quation r√©duite de la droite \\(d_1\\) <br>
    passant par le point \\(A(${e};${f})\\) et <br>
    perpendiculaire √† la droite \\(d_2 \\equiv ${equationCartesienne(a, b, c)}\\).`;
  }


  document.getElementById("equation").innerHTML = enonce;
  MathJax.typeset();
}



 /*==============
     VERFICATION
==================*/

function verifier() {

  const rep = normaliser(document.getElementById("reponse").value);

  /* ===== CAS 2 : droite verticale ===== */
  if (cas === 2) {

const attendu = equationReduite(m, p);

if (rep === normaliser(attendu)) {
  document.getElementById("feedback").innerHTML =
    "<span class='bon'>‚úÖ Bonne r√©ponse !</span>";
} else {
  document.getElementById("feedback").innerHTML =
    "<span class='faux'>‚ùå R√©ponse incorrecte</span>";
}

    return;
  }

  /* ===== AUTRES CAS : y = mx + p ===== */
let attendu = "y=";

const tx = termeX(m);
const tp = termeConstante(p);

attendu += tx;

if (tp !== "") {
  // cas o√π m = 0 ‚Üí √©viter y=+2
  if (tx === "") attendu += tp.replace("+", "");
  else attendu += tp;
}

  if (rep === normaliser(attendu)) {
    document.getElementById("feedback").innerHTML =
      "<span class='bon'>‚úÖ Bonne r√©ponse !</span>";
  } else {
    document.getElementById("feedback").innerHTML =
      "<span class='faux'>‚ùå R√©ponse incorrecte</span>";
  }
}


  /*==============
    CORRECTION
  ===============*/

function corriger() {

  const bloc = document.getElementById("correction");

  // üîÅ TOGGLE : si visible ‚Üí cacher
  if (bloc.style.display === "block") {
    bloc.style.display = "none";
    return;
  }

  // sinon ‚Üí afficher et g√©n√©rer la correction
  bloc.style.display = "block";

  
  let texte = `üìò <strong>R√©solution</strong><br><br>  `;
  
  /* ===== CAS 1 : droite horizontale ===== */

  if (cas === 1) {

      texte += `Une droite parall√®le √† l'axe des abscisses est une droite horizontale d'√©quation \\( y=k\\).<br><br>
      Ainsi, en consid√©rant l'ordonn√©e du point A, on obtient <br><br> 
      \\( \\mathbf{ y = ${f} } \\) `;

    document.getElementById("correction").innerHTML = texte;
    MathJax.typeset();
    return;
  }
  
  /* ===== CAS 2 : droite verticale ===== */
  if (cas === 2) {
    
      texte += `Une droite parall√®le √† l'axe des ordonn√©es est une droite verticale d'√©quation \\( x=k\\).<br><br>
      Ainsi, en consid√©rant l'abscisse du point A, on obtient <br><br> 
      \\( \\mathbf{  x = ${e} } \\) `;

    document.getElementById("correction").innerHTML = texte;
    MathJax.typeset();
    return; 
  }

  /* ===== CAS 3 : droite passant par 2 points ===== */

  if (cas === 3) {

    texte += ` "Hello" `;

    document.getElementById("correction").innerHTML = texte;
    MathJax.typeset();
    return;

  }

  /* ===== CAS 4/5 : D_2 PARALLELES OU PERPENDICULAIRES ===== */
  
else {

  const aAbs = Math.abs(a);
  const cAbs = Math.abs(c);
  const bAbs = Math.abs(b);
  let m2 = null;
  let m2Texte = "";
  let mFrac = null;

  
  texte += `
  <span style='color: var(--peps); font-weight: bold;'> √âtape 1 : </span>  <span style='color: var(--peps)'>r√©duire l‚Äô√©quation de \\(d_2\\) </span> <br>
  `;

if (Math.abs(b) === 1) {

  m2 = -a * b;

  m2Texte =
    m2 === 1 ? "" :
    m2 === -1 ? "-" :
    m2.toString();

  const p2 = -c * b;
  const p2Texte =
    p2 === 0 ? "" :
    p2 > 0 ? `+${p2}` : `${p2}`;

  texte += `
  \\[
  \\begin{aligned}
  ${equationCartesienne(a, b, c)} \\\\
  y &= ${m2Texte}x ${p2Texte} \\quad (m_2 = ${m2})
  \\end{aligned}
  \\]
  `;
}
else {

  mFrac = fractionIrreductible(-a, b);
  const pFrac = fractionIrreductible(-c, b);

  
  /* ===== CAS b > 0 ===== */
if (b > 0) {

texte += `
\\[
\\begin{aligned}
${Aff(a)}x   + ${Aff(b)}y ${c >= 0 ? '+' : '-'} ${cAbs}&= 0 \\\\
${Aff(b)}y &= ${Aff(-a)}x ${c >= 0 ? '-' : '+'} ${cAbs} \\\\
\\frac{${b}}{${b}}y &= ${a >= 0 ? '-' : ''} \\frac{${aAbs}}{${b}}x ${c >= 0 ? '-' : '+'} \\frac{${cAbs}}{${b}}  \\\\
y &=  ${afficherCoefX(mFrac)} x  ${afficherConstante(pFrac)}  \\quad (m_2 = ${afficherCoefX(mFrac)})\\\\
\\end{aligned}
\\]
`;
}


/* ===== CAS b < 0 ===== */
else {

texte += `
\\[
\\begin{aligned}
${Aff(a)}x ${b >= 0 ? '+' : '-'} ${bAbs}y ${c >= 0 ? '+' : '-'} ${cAbs}&= 0 \\\\
${Aff(a)}x ${c >= 0 ? '+' : '-'} ${cAbs} &= ${-b}y \\\\
${a >= 0 ? '' : '-'}\\frac{${aAbs}}{${-b}}x ${c >= 0 ? '+' : '-'} \\frac{${cAbs}}{${-b}} &= \\frac{${-b}}{${-b}}y \\\\
y &=  ${afficherCoefX(mFrac)} x  ${afficherConstante(pFrac)}  \\quad (m_2 = ${afficherCoefX(mFrac)})\\\\ 
\\end{aligned}
\\]
`;
}
  }

let m1 = null;
let p1 = null;

  
    texte += `
  <span style='color: var(--peps); font-weight: bold;'> √âtape 2 : </span>  <span style='color: var(--peps)'> trouver la pente de \\(d_1\\) </span> <br><br>
 `;
if (cas === 4) {

  if (Math.abs(b) === 1) {
    m1 = m2;
    p1 = f - m1 * e;

texte += `
\\( d_1 // d_2 \\)<br>
\\( \\Rightarrow m_1 = ${m1} \\)<br>
\\( \\Rightarrow \\mathbf{ y = ${m1}x ${p1 >= 0 ? "+" : ""}${p1} } \\)
`;

  } else {
    m1 = mFrac.num / mFrac.den;
    p1 = f - m1 * e;

texte += `
\\( d_1 // d_2 \\)<br>
\\( \\Rightarrow m_1 = ${m1} \\)<br>
\\( \\Rightarrow \\mathbf{ y = ${m1}x ${p1 >= 0 ? "+" : ""}${p1} } \\)
`;

  }
}

 
else {

  if (Math.abs(b) === 1) {
    m1 = -1 / m2;
    p1 = f - m1 * e;

texte += `
\\( d_1 \\perp d_2 \\)<br>
\\( \\Rightarrow m_1 = ${m1} \\)<br>
\\( \\Rightarrow \\mathbf{ y = ${m1}x ${p1 >= 0 ? "+" : ""}${p1} } \\)
`;

  } else {
    
const m1Frac = { 
  num: -mFrac.den, 
  den: mFrac.num 
}; // pente perpendiculaire

const m1Latex = opposeInverseLatex(mFrac);
const m1Value = -mFrac.den / mFrac.num;


p1 = f - m1Value * e;

texte += `
\\( d_1 \\perp d_2 \\)<br>
\\( \\Rightarrow m_1 = -\\frac{1}{m_2} = ${m1Latex} \\)<br>
\\( \\Rightarrow \\mathbf{ y = ${m1Latex}x +p } \\)
`;

  }
}

texte += `
<span style='color: var(--peps); font-weight: bold;'> √âtape 3 : </span> <span style='color: var(--peps)'> trouver le \\(p\\) de \\(d_1\\) </span> <br><br>

\\( A(${e};${f}) \\in d_1 \\)

\\[
\\begin{aligned}
${f} &= ${m1Latex} \\cdot ${e} + p \\\\
p &= ${f} - ${m1Latex} \\cdot ${e}
\\end{aligned}
\\]
`;


  
  document.getElementById("correction").innerHTML = texte;
  MathJax.typeset();
}
}

generer();
</script>

     
  <!-- Protection clique droit (commun √† tout le site) -->
  <script src="../../../js/protection.js"></script>
  
</body>
</html>
