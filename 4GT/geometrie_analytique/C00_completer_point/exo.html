<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="enonce"></div>

  <input type="text" id="reponse" placeholder="...">

  <button onclick="verifier()">V√©rifier</button>
  <button onclick="corriger()">Correction</button>
  <button onclick="generer()">Nouvel exercice</button>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
/* =====================================================
   OUTILS FRACTIONS
===================================================== */
function pgcd(a,b){
  a=Math.abs(a); b=Math.abs(b);
  while(b!==0){ let t=b; b=a%b; a=t; }
  return a;
}

function ppcm(a,b){
  return Math.abs(a*b)/pgcd(a,b);
}

function ppcmListe(dens){
  return dens.reduce((acc,d)=>ppcm(acc,d),1);
}

function fractionIrreductible(num, den){
  if(den<0){ num=-num; den=-den; }
  const p=pgcd(num,den);
  return {num:num/p, den:den/p};
}

function fractionLatex(num, den){
  if(num===0) return "0";
  if(den===1) return num.toString();
  if(num<0) return `-\\frac{${Math.abs(num)}}{${den}}`;
  return `\\frac{${num}}{${den}}`;
}

/* =====================================================
   ALEATOIRE
===================================================== */
function randIntNonZeroNotOne(){
  let x;
  do{
    x=Math.floor(Math.random()*11)-5;
  }while(x===0||x===1||x===-1);
  return x;
}

function tirerDansE(options = {}){
  const E = [
    {num:1,den:2},{num:1,den:3},{num:2,den:3},
    {num:3,den:2},{num:2,den:5},{num:3,den:5}
  ];
  let f;
  do{
    f = E[Math.floor(Math.random()*E.length)];
  }while(
    (options.nonZero && f.num===0) ||
    (options.nonOne && Math.abs(f.num)===f.den)
  );
  return f;
}

function renderMath(el){
  MathJax.typesetClear([el]);
  MathJax.typesetPromise([el]);
}

function termeSigne(val, contenu = ""){
  if(val === 0) return "";
  if(val > 0) return `+ ${val}${contenu}`;
  return `- ${Math.abs(val)}${contenu}`;
}

/* =====================================================
   VARIABLES
===================================================== */
let solution;
let texteCorrection="";
let dernierEnonce="";

/* =====================================================
   GENERATION
===================================================== */
function generer(){

  let enonce="";
  texteCorrection="";

  const cas = Math.random()<0.9 ? 1 : 2;
  const coordDonnee = Math.random()<0.5 ? "x" : "y";
  const valeur = Math.floor(Math.random()*7)-3;

  /* ======================
     CAS 1 : y = mx + p
  ====================== */
  if(cas===1){

    const m = tirerDansE({nonZero:true, nonOne:true});
    const p = tirerDansE();

    /* ===== x donn√© ‚Üí y cherch√© ===== */
    if(coordDonnee==="x"){

      let texte = "";

      /* √âNONC√â */
      let eq = `y = ${fractionLatex(m.num,m.den)}x`;
      if(p.num!==0){
        eq += " " + (p.num>0
          ? `+ ${fractionLatex(p.num,p.den)}`
          : `- ${fractionLatex(Math.abs(p.num),p.den)}`
        );
      }

      enonce = `
      La droite a pour √©quation :<br>
      \\( ${eq} \\)<br><br>
      Compl√®te les coordonn√©es du point \\( A(${valeur};\\dots) \\)<br>
      afin qu'il appartienne √† la droite.
      `;

      /* √âTAPE 1 */
      texte += `
      <u>√âtape 1</u> : on remplace x par ${valeur}<br>
      \\[
      y = ${fractionLatex(m.num,m.den)}\\cdot ${valeur}
      ${p.num>=0?"+ ":"- "}${fractionLatex(Math.abs(p.num),p.den)}
      \\]
      `;

      /* √âTAPE 2 : calcul du produit */
      const mxNum = m.num * valeur;
      const mxDen = m.den;

      let mx;
      let mxEstFraction = false;

      if(mxDen===1){
        mx = mxNum;
      }else if(Math.abs(mxNum)%mxDen===0){
        mx = mxNum/mxDen;
      }else{
        mx = fractionIrreductible(mxNum,mxDen);
        mxEstFraction = true;
      }

      texte += `
      <u>√âtape 2</u> : on effectue et/ou on simplifie<br>
      \\[
      y =
      ${mxEstFraction?fractionLatex(mx.num,mx.den):mx}
      ${p.num===0?"":(p.num>0?"+ ":"- ")+fractionLatex(Math.abs(p.num),p.den)}
      \\]
      `;

      /* √âTAPE 3 / 4 */
      if(!mxEstFraction && p.den===1){

        const somme = mx + p.num;
        solution = {num:somme, den:1};

        texte += `
        <u>√âtape 3</u> : on calcule<br>
        \\[
        y = ${somme}
        \\]
        `;

      }else{

        const den = ppcmListe([
          mxEstFraction?mx.den:1,
          p.den
        ]);

        const n1 = mxEstFraction?mx.num*(den/mx.den):mx*den;
        const n2 = p.num*(den/p.den);

        texte += `
        <u>√âtape 3</u> : on met sur le m√™me d√©nominateur<br>
        \\[
        y =
        ${fractionLatex(n1,den)}
        ${p.num>=0?"+ ":"- "}${fractionLatex(Math.abs(n2),den)}
        \\]
        `;

        const somme = fractionIrreductible(n1+n2,den);
        solution = somme;

        texte += `
        <u>√âtape 4</u> : on calcule<br>
        \\[
        y = ${fractionLatex(somme.num,somme.den)}
        \\]
        `;
      }

      texte += `
      üëâ Coordonn√©e cherch√©e :
      \\( \\boxed{${fractionLatex(solution.num,solution.den)}} \\)
      `;

      texteCorrection = texte;
    }

    /* ===== y donn√© ‚Üí x cherch√© (inchang√©) ===== */
    else{

      solution = fractionIrreductible(
        valeur*m.den - p.num,
        m.num
      );

      enonce = `
      La droite a pour √©quation :<br>
      \\( y = ${fractionLatex(m.num,m.den)}x + ${fractionLatex(p.num,p.den)} \\)<br><br>
      Compl√®te les coordonn√©es du point<br>
      \\( A(\\dots;${valeur}) \\)
      `;

      let etape1 = `y = ${fractionLatex(m.num,m.den)}\\cdot ${valeur}`;
      if(p.num!==0){
        etape1 += " " + (p.num>0
          ? `+ ${fractionLatex(p.num,p.den)}`
          : `- ${fractionLatex(Math.abs(p.num),p.den)}`
        );
      }

      texteCorrection = `
      <u>√âtape 1</u> : on remplace y par ${valeur}<br>
      \\[
      ${etape1}
      \\]

      <u>√âtape 2</u> : on isole x<br>
      \\[
      x = ${fractionLatex(solution.num,solution.den)}
      \\]

      üëâ Coordonn√©e cherch√©e :
      \\( \\boxed{${fractionLatex(solution.num,solution.den)}} \\)
      `;
    }
  }

  /* =========================
     CAS 2 : ax + by + c = 0
  ========================= */
  else {

    const a = randIntNonZeroNotOne();
    const b = randIntNonZeroNotOne();
    const c = randIntNonZeroNotOne();

    if(coordDonnee==="x"){
      solution = fractionIrreductible(-a*valeur - c, b);

    let eq = "";
    eq += (a<0?"-":"") + (Math.abs(a)===1?"":Math.abs(a)) + "x";
    eq += " " + termeSigne(b,"y");
    eq += " " + termeSigne(c);
    eq += " = 0";


      
      enonce = `
      La droite a pour √©quation :<br>
      \\( ${eq} \\)<br><br>
      Compl√®te les coordonn√©es du point \\( A(${valeur};\\dots) \\) <br>
      afin qu'il appartienne √† la droite.
      `;

      let etape1 = "";
      etape1 += `${a}\\cdot ${valeur}`;
      etape1 += " " + termeSigne(b,"y");
      etape1 += " " + termeSigne(c);
      etape1 += " = 0";

      texteCorrection = `
      <u>√âtape 1</u> : on remplace x par ${valeur}<br>
      \\[
        ${etape1}
      \\]


      <u>√âtape 2</u> : on isole y<br>
      \\[
      ${b}y = ${-a*valeur-c}
      \\]

      <u>√âtape 3</u> : on divise par ${b}<br>
      \\[
      y = ${fractionLatex(solution.num,solution.den)}
      \\]

      üëâ Coordonn√©e cherch√©e :
      \\( \\boxed{${fractionLatex(solution.num,solution.den)}} \\)
      `;
    }

    else {
      solution = fractionIrreductible(-b*valeur - c, a);

      enonce = `
      La droite a pour √©quation :<br>
      \\( ${a}x + ${b}y + ${c} = 0 \\)<br><br>
      Compl√®te les coordonn√©es du point<br>
      \\( A(\\dots;${valeur}) \\)
      `;

      texteCorrection = `
      <u>√âtape 1</u> : on remplace y par ${valeur}<br>
      \\[
      ${a}x + ${b}\\cdot ${valeur} + ${c} = 0
      \\]

      <u>√âtape 2</u> : on isole x<br>
      \\[
      x = ${fractionLatex(solution.num,solution.den)}
      \\]

      üëâ Coordonn√©e cherch√©e :
      \\( \\boxed{${fractionLatex(solution.num,solution.den)}} \\)
      `;
    }
  }

  if(enonce===dernierEnonce){ generer(); return; }
  dernierEnonce=enonce;

  document.getElementById("enonce").innerHTML=enonce;
  document.getElementById("feedback").innerHTML="";
  document.getElementById("reponse").value="";
  renderMath(document.getElementById("enonce"));
}

/* =====================================================
   VERIFICATION
===================================================== */
function verifier(){
  const r=document.getElementById("reponse").value.replace(" ","");
  const f=document.getElementById("feedback");

  const bonnes=[
    solution.den===1 ? `${solution.num}` : `${solution.num}/${solution.den}`
  ];

  if(bonnes.includes(r)){
    f.style.color="green";
    f.innerHTML="‚úÖ Correct";
  }else{
    f.style.color="red";
    f.innerHTML="‚ùå Incorrect";
  }
}

/* =====================================================
   CORRECTION
===================================================== */
function corriger(){
  const f=document.getElementById("feedback");
  f.style.color="#000";
  f.innerHTML=`üìò <strong>Correction</strong><br><br>${texteCorrection}`;
  renderMath(f);
}

/* =====================================================
   INIT
===================================================== */
generer();
</script>

<script src="../../../js/protection.js"></script>

</body>
</html>
