<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="enonce"></div>

  <input type="text" id="reponse" placeholder="...">

  <button onclick="verifier()">V√©rifier</button>
  <button onclick="corriger()">R√©solution</button>
  <button onclick="generer()">Nouvel exercice</button>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
  /* =====================================================
   OUTILS 
===================================================== */
  const ENSEMBLE_E = [
  { num: 0, den: 1 },
  { num: 1, den: 1 },
  { num: 2, den: 1 },
  { num: 3, den: 1 },
  { num: 4, den: 1 },
  { num: 5, den: 1 },
  { num: 1, den: 2 },
  { num: 1, den: 3 },
  { num: 1, den: 4 },
  { num: 1, den: 5 },
  { num: 2, den: 3 },
  { num: 2, den: 5 },
  { num: 3, den: 2 },
  { num: 3, den: 4 },
  { num: 3, den: 5 },
  { num: 4, den: 3 },
  { num: 4, den: 5 }
];

  
/* =====================================================
   OUTILS FRACTIONS
===================================================== */
function pgcd(a,b){
  a=Math.abs(a); b=Math.abs(b);
  while(b!==0){ let t=b; b=a%b; a=t; }
  return a;
}

function ppcm(a,b){
  return Math.abs(a*b)/pgcd(a,b);
}

function ppcmListe(dens){
  return dens.reduce((acc,d)=>ppcm(acc,d),1);
}

function fractionIrreductible(num, den){
  if(den<0){ num=-num; den=-den; }
  const p=pgcd(num,den);
  return {num:num/p, den:den/p};
}

function fractionLatex(num, den){
  if(num===0) return "0";
  if(den===1) return num.toString();
  if(num<0) return `-\\frac{${Math.abs(num)}}{${den}}`;
  return `\\frac{${num}}{${den}}`;
}

function afficheSomme(val1, val2) {
  if (val1 === 0) return `${val2}`;
  if (val2 === 0) return `${val1}`;
  return `${val1} ${val2 > 0 ? "+ " : "- "}${Math.abs(val2)}`;
}


/* =====================================================
   ALEATOIRE
===================================================== */
function randIntNonZeroNotOne(){
  let x;
  do{
    x=Math.floor(Math.random()*11)-5;
  }while(x===0||x===1||x===-1);
  return x;
}

  
function tirerE() {
  const base = ENSEMBLE_E[Math.floor(Math.random() * ENSEMBLE_E.length)];
  const signe = Math.random() < 0.5 ? -1 : 1;

  const num = signe * base.num;
  const den = base.den;

  return {
    num,
    den,
    valeur: num / den,
    latex: den === 1
      ? `${num}`
      : (num < 0
          ? `-\\frac{${Math.abs(num)}}{${den}}`
          : `\\frac{${num}}{${den}}`)
  };
}

function afficheProduit(latexVal, valeurNum) {
  return valeurNum < 0 ? `(${latexVal})` : latexVal;
}


function renderMath(el){
  MathJax.typesetClear([el]);
  MathJax.typesetPromise([el]);
}

function termeSigne(val, contenu = ""){
  if(val === 0) return "";
  if(val > 0) return `+ ${val}${contenu}`;
  return `- ${Math.abs(val)}${contenu}`;
}

/* =====================================================
   VARIABLES
===================================================== */
let solution;
let texteCorrection="";
let dernierEnonce="";

/* =====================================================
   GENERATION
===================================================== */
function generer(){

  let enonce="";
  texteCorrection="";

const cas = Math.random()<0.1 ? 1 : 2;
const coordDonnee = Math.random()<0.5 ? "x" : "y";
const eObj = tirerE();
const valeur = eObj.valeur;   // POUR LES CALCULS
const valeurAff = eObj.latex; // POUR L‚ÄôAFFICHAGE
const yAffProd = afficheProduit(valeurAff, valeur);


  /* ======================
     CAS 1 : y = mx + p
  ====================== */
  if(cas===1){

let m;
do {
  m = tirerE();
} while (m.num === 0);
const p = tirerE();


    /* ===== x donn√© ‚Üí y cherch√© ===== */
    if(coordDonnee==="x"){

      let texte = "";

      /* √âNONC√â */
      let eq = `y = ${fractionLatex(m.num,m.den)}x`;
      if(p.num!==0){
        eq += " " + (p.num>0
          ? `+ ${fractionLatex(p.num,p.den)}`
          : `- ${fractionLatex(Math.abs(p.num),p.den)}`
        );
      }

      enonce = `
      La droite a pour √©quation :<br>
      \\( ${eq} \\)<br><br>
      Compl√®te les coordonn√©es du point \\( A(${valeurAff};\\dots) \\)<br>
      afin qu'il appartienne √† la droite.
      `;
/*CORRECTION */
      
const xAffProd = afficheProduit(valeurAff, valeur);

      /* √âTAPE 1 */
      texte += `
      <u>√âtape 1</u> : on remplace x par l'abscisse du point A<br>
      \\[
      y = ${fractionLatex(m.num,m.den)}\\cdot ${valeurAff}
      ${p.num>=0?"+ ":"- "}${fractionLatex(Math.abs(p.num),p.den)}
      \\]
      `;

      /* √âTAPE 2 : calcul du produit */
      const mxNum = m.num * valeur;
      const mxDen = m.den;

      let mx;
      let mxEstFraction = false;

      if(mxDen===1){
        mx = mxNum;
      }else if(Math.abs(mxNum)%mxDen===0){
        mx = mxNum/mxDen;
      }else{
        mx = fractionIrreductible(mxNum,mxDen);
        mxEstFraction = true;
      }

      texte += `
      <u>√âtape 2</u> : on effectue et/ou on simplifie<br>
      \\[
      y =
      ${mxEstFraction?fractionLatex(mx.num,mx.den):mx}
      ${p.num===0?"":(p.num>0?"+ ":"- ")+fractionLatex(Math.abs(p.num),p.den)}
      \\]
      `;

      /* √âTAPE 3 / 4 */
      if(!mxEstFraction && p.den===1){

        const somme = mx + p.num;
        solution = {num:somme, den:1};

        texte += `
        <u>√âtape 3</u> : on calcule<br>
        \\[
        y = ${somme}
        \\]
        `;

      }else{

        const den = ppcmListe([
          mxEstFraction?mx.den:1,
          p.den
        ]);

        const n1 = mxEstFraction?mx.num*(den/mx.den):mx*den;
        const n2 = p.num*(den/p.den);

        texte += `
        <u>√âtape 3</u> : on met sur le m√™me d√©nominateur<br>
        \\[
        y =
        ${fractionLatex(n1,den)}
        ${p.num>=0?"+ ":"- "}${fractionLatex(Math.abs(n2),den)}
        \\]
        `;

        const somme = fractionIrreductible(n1+n2,den);
        solution = somme;

        texte += `
        <u>√âtape 4</u> : on calcule<br>
        \\[
        y = ${fractionLatex(somme.num,somme.den)}
        \\]
        `;
      }


      texteCorrection = texte;
    }

    /* ===== y donn√© ‚Üí x recherch√© ===== */
else {

  let texte = "";

  /* √âNONC√â */
  let eq = `y = ${fractionLatex(m.num,m.den)}x`;
  if(p.num!==0){
    eq += " " + (p.num>0
      ? `+ ${fractionLatex(p.num,p.den)}`
      : `- ${fractionLatex(Math.abs(p.num),p.den)}`
    );
  }

  enonce = `
  La droite a pour √©quation :<br>
  \\( ${eq} \\)<br><br>
  Compl√®te les coordonn√©es du point \\( A(\\dots;${valeurAff}) \\) <br>
  afin qu'il appartienne √† la droite.
  `;


  /*  √âTAPE 1 : substitution
  ================================================= */
texte += `
<u>√âtape 1</u> : on remplace y par l'ordonn√©e du point A<br>
\\[
${valeurAff} =
${fractionLatex(m.num,m.den)}x
${p.num>=0?"+ ":"- "}${fractionLatex(Math.abs(p.num),p.den)}
\\]
`;


  /*  √âTAPE 2 : on isole mx
  ================================================= */
  const den = p.den;                 // d√©nominateur commun
const n1 = valeur * den;           // y
const n2 = p.num;                  // p

texte += `
<u>√âtape 2</u> : on isole le terme en x <br>
\\[
${valeur} ${p.num>=0?"- ":"+ "}${fractionLatex(Math.abs(p.num),p.den)}=
${fractionLatex(m.num,m.den)}x
\\]
`;

    /* √âTAPE 3 : on met sur le m√™me d√©nominateur
  ================================================= */

texte += `
<u>√âtape 2</u> : on met sur le m√™me d√©nominateur √† gauche<br>
\\[
${fractionLatex(n1,den)}
${p.num>=0?"- ":"+ "}${fractionLatex(Math.abs(n2),den)}
= ${fractionLatex(m.num,m.den)}x
\\]
`;

  
  /* √âTAPE 4 : on calcule
  ================================================= */
const numGauche = n1 - n2;
const gauche = fractionIrreductible(numGauche, den);

texte += `
<u>√âtape 3</u> : on calcule <br>
\\[
${fractionLatex(gauche.num,gauche.den)}
= ${fractionLatex(m.num,m.den)}x
\\]
`;

/*     √âTAPE 5 : on isole x
  ================================================= */

  
const xNum = gauche.num * m.den;
const xDen = gauche.den * m.num;
solution = fractionIrreductible(xNum, xDen);

texte += `
<u>√âtape 4</u> : on isole x et on calcule <br>
\\[
x = ${fractionLatex(gauche.num,gauche.den)} \\cdot ${fractionLatex(m.den,m.num)} =  ${fractionLatex(solution.num, solution.den)}

\\]
`;


  

  texteCorrection = texte;
}
  }

  /* =========================
     CAS 2 : ax + by + c = 0
  ========================= */
  else {

    const a = randIntNonZeroNotOne();
    const b = randIntNonZeroNotOne();
    const c = randIntNonZeroNotOne();

  /* =====================================================
   x donn√© ‚Üí y recherch√©
===================================================== */

if (coordDonnee === "x") {

  let texte = "";

  /* ========= √âNONC√â ========= */
  let eq = "";
  eq += (a < 0 ? "-" : "") + (Math.abs(a) === 1 ? "" : Math.abs(a)) + "x";
  eq += " " + termeSigne(b, "y");
  eq += " " + termeSigne(c);
  eq += " = 0";

  enonce = `
  La droite a pour √©quation :<br>
  \\( ${eq} \\)<br><br>
  Compl√®te les coordonn√©es du point \\( A(${valeurAff};\\dots) \\)<br>
  afin qu'il appartienne √† la droite.
  `;

  /* ========= √âTAPE 1 : substitution ========= */

  const xAffProd = afficheProduit(valeurAff, valeur);

  texte += `
  <u>√âtape 1</u> : on remplace x par l‚Äôabscisse du point A<br>
  \\[
  ${a}\\cdot ${xAffProd}
  ${termeSigne(b, "y")}
  ${termeSigne(c)}
  = 0
  \\]
  `;

  /* ========= √âTAPE 2 : calcul de ax (EN FRACTION) et isolement de y ========= */

  // ax = a * eObj.num / eObj.den
  const axNum = a * eObj.num;
  const axDen = eObj.den;

  let ax;
  let axEstFraction = false;

  if (axDen === 1) {
    ax = axNum;
  } else if (Math.abs(axNum) % axDen === 0) {
    ax = axNum / axDen;
  } else {
    ax = fractionIrreductible(axNum, axDen);
    axEstFraction = true;
  }

  let coefY;   // coefficient positif devant y
  let terme1;  // premier terme du membre sans y
  let terme2;  // second terme (c ou -c)

  if (b > 0) {
    coefY = b;
    terme1 = axEstFraction ? { num: -ax.num, den: ax.den } : -ax;
    terme2 = -c;

    texte += `
    <u>√âtape 2</u> : on effectue et on isole le terme en y<br>
    \\[
    ${b}y =
    ${axEstFraction
      ? fractionLatex(-ax.num, ax.den)
      : -ax}
    ${c >= 0 ? " - " : " + "}${Math.abs(c)}
    \\]
    `;
  } else {
    coefY = -b;
    terme1 = ax;
    terme2 = c;

    texte += `
    <u>√âtape 2</u> : on effectue et on isole le terme en y<br>
    \\[
    ${axEstFraction
      ? fractionLatex(ax.num, ax.den)
      : ax}
    ${c >= 0 ? " + " : " - "}${Math.abs(c)}
    = ${coefY}y
    \\]
    `;
  }

  /* ========= TEST : reste-t-il une fraction ? ========= */

  const resteFraction = axEstFraction;

  /* ========= √âTAPE 3 / 4 ========= */

  if (!resteFraction) {

    /* ----- CAS SANS FRACTION ----- */

    const resultat = terme1 + terme2;

    texte += `
    <u>√âtape 3</u> : on calcule<br>
    \\[
    ${b > 0 ? `${coefY}y = ${resultat}` : `${resultat} = ${coefY}y`}
    \\]
    `;

    solution = fractionIrreductible(resultat, coefY);

    texte += `
    <u>√âtape 4</u> : on isole y<br>
    \\[
    y = ${fractionLatex(solution.num, solution.den)}
    \\]
    `;

  } else {

    /* ----- CAS AVEC FRACTION ----- */

    const den = ax.den;

    const n1 = (b > 0 ? terme1.num : terme1.num);
    const n2 = terme2 * den;

texte += `
<u>√âtape 3</u> : on met sur le m√™me d√©nominateur<br>
\\[
${coefY}y = ${fractionLatex(n1, den)}
${terme2 >= 0 ? "+ " : "- "}${fractionLatex(Math.abs(n2), den)}

\\]
`;


    const somme = fractionIrreductible(n1 + n2, den);

    texte += `
    <u>√âtape 4</u> : on calcule<br>
    \\[
    ${b > 0
      ? `${coefY}y = ${fractionLatex(somme.num, somme.den)}`
      : `${fractionLatex(somme.num, somme.den)} = ${coefY}y`}
    \\]
    `;

    solution = fractionIrreductible(somme.num, somme.den * coefY);

texte += `
<u>√âtape 5</u> : on isole y<br>
\\[
y = ${fractionLatex(somme.num, somme.den)}
\\cdot ${fractionLatex(1, coefY)}
= ${fractionLatex(solution.num, solution.den)}
\\]
`;

  }

      
texteCorrection = texte;

    }

else if (coordDonnee === "y") {

  let texte = "";

  /* ========= √âNONC√â ========= */
  let eq = "";
  eq += (a < 0 ? "-" : "") + (Math.abs(a) === 1 ? "" : Math.abs(a)) + "x";
  eq += " " + termeSigne(b, "y");
  eq += " " + termeSigne(c);
  eq += " = 0";

  enonce = `
  La droite a pour √©quation :<br>
  \\( ${eq} \\)<br><br>
  Compl√®te les coordonn√©es du point \\( A(\\dots ; ${valeurAff}) \\)<br>
  afin qu'il appartienne √† la droite.
  `;

  /* ========= √âTAPE 1 : substitution ========= */

  texte += `
  <u>√âtape 1</u> : on remplace y par l‚Äôordonn√©e du point A<br>
  \\[
  ${a}x
  ${b > 0 ? "+ " : "- "}${Math.abs(b)} \\cdot ${yAffProd}
  ${termeSigne(c)}
  = 0
  \\]
  `;


  
  /* ========= √âTAPE 2 : calcul de by (EN FRACTION) et isolement de x ========= */

  // by = b * fObj.num / fObj.den
const byNum = b * eObj.num;
const byDen = eObj.den;


  let by;
  let byEstFraction = false;

  if (byDen === 1) {
    by = byNum;
  } else if (Math.abs(byNum) % byDen === 0) {
    by = byNum / byDen;
  } else {
    by = fractionIrreductible(byNum, byDen);
    byEstFraction = true;
  }

  let coefX;   // coefficient positif devant x
  let terme1;  // premier terme du membre sans x
  let terme2;  // second terme (c ou -c)

  if (a > 0) {
    coefX = a;
    terme1 = byEstFraction ? { num: -by.num, den: by.den } : -by;
    terme2 = -c;

    texte += `
    <u>√âtape 2</u> : on effectue et on isole le terme en x<br>
    \\[
    ${a}x =
    ${byEstFraction
      ? fractionLatex(-by.num, by.den)
      : -by}
    ${c >= 0 ? " - " : " + "}${Math.abs(c)}
    \\]
    `;
  } else {
    coefX = -a;
    terme1 = by;
    terme2 = c;

    texte += `
    <u>√âtape 2</u> : on effectue et on isole le terme en x<br>
    \\[
    ${byEstFraction
      ? fractionLatex(by.num, by.den)
      : by}
    ${c >= 0 ? " + " : " - "}${Math.abs(c)}
    = ${coefX}x
    \\]
    `;
  }

  /* ========= TEST : reste-t-il une fraction ? ========= */

  const resteFraction = byEstFraction;

  /* ========= √âTAPE 3 / 4 ========= */

  if (!resteFraction) {

    /* ----- CAS SANS FRACTION ----- */

    const resultat = terme1 + terme2;

    texte += `
    <u>√âtape 3</u> : on calcule<br>
    \\[
    ${a > 0 ? `${coefX}x = ${resultat}` : `${resultat} = ${coefX}x`}
    \\]
    `;

    solution = fractionIrreductible(resultat, coefX);

    texte += `
    <u>√âtape 4</u> : on isole x<br>
    \\[
    x = ${fractionLatex(solution.num, solution.den)}
    \\]
    `;

  } else {

    /* ----- CAS AVEC FRACTION ----- */

    const den = by.den;

    const n1 = terme1.num;
    const n2 = terme2 * den;

    texte += `
    <u>√âtape 3</u> : on met sur le m√™me d√©nominateur<br>
    \\[
    ${fractionLatex(n1, den)}
    ${terme2 >= 0 ? "+ " : "- "}${fractionLatex(Math.abs(n2), den)} = ${coefX}x
    \\]
    `;

    const somme = fractionIrreductible(n1 + n2, den);

    texte += `
    <u>√âtape 4</u> : on calcule<br>
    \\[
    ${a > 0
      ? `${coefX}x = ${fractionLatex(somme.num, somme.den)}`
      : `${fractionLatex(somme.num, somme.den)} = ${coefX}x`}
    \\]
    `;

    solution = fractionIrreductible(somme.num, somme.den * coefX);

    texte += `
    <u>√âtape 5</u> : on isole x<br>
    \\[
    x = ${fractionLatex(somme.num, somme.den)}
    \\cdot ${fractionLatex(1, coefX)}
    = ${fractionLatex(solution.num, solution.den)}
    \\]
    `;
  }

  texteCorrection = texte;
}

    }
  

  if(enonce===dernierEnonce){ 
    generer(); 
    return; }
  dernierEnonce=enonce;

  document.getElementById("enonce").innerHTML=enonce;
  document.getElementById("feedback").innerHTML="";
  document.getElementById("reponse").value="";
  renderMath(document.getElementById("enonce"));
}

/* =====================================================
   VERIFICATION
===================================================== */
function verifier(){
  const r=document.getElementById("reponse").value.replace(" ","");
  const f=document.getElementById("feedback");

  const bonnes=[
    solution.den===1 ? `${solution.num}` : `${solution.num}/${solution.den}`
  ];

  if(bonnes.includes(r)){
    f.style.color="green";
    f.innerHTML="‚úÖ Correct";
  }else{
    f.style.color="red";
    f.innerHTML="‚ùå Incorrect";
  }
}

/* =====================================================
   CORRECTION
===================================================== */
function corriger(){
  const f=document.getElementById("feedback");
  f.style.color="#000";
  f.innerHTML=`üìò <strong>Correction</strong><br><br>${texteCorrection}`;
  renderMath(f);
}

/* =====================================================
   INIT
===================================================== */
generer();
</script>

<script src="../../../js/protection.js"></script>

</body>
</html>
