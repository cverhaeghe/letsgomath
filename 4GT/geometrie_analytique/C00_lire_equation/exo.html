<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<!-- CSS -->
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- MathJax v3 -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <p>Lis lâ€™Ã©quation de la droite reprÃ©sentÃ©e.</p>

  <!-- GRAPHIQUE -->
  <div style="display:flex;justify-content:center;margin-bottom:20px;">
    <svg id="graph" width="400" height="400" viewBox="0 0 400 400"></svg>
  </div>

  <!-- SAISIE ELEVE -->
  <div class="equation-box">
    <input id="reponse" type="text" class="form-control"
           placeholder="...">
  </div>

  <div class="center-button">
    <button onclick="verifier()">VÃ©rifier</button>
    <button onclick="afficherCorrection()">Correction</button>    
    <button onclick="genererExercice()">Nouvel exercice</button>
  </div>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
/* ====================== PARAMETRES REPERE ====================== */
const svg = document.getElementById("graph");
const width = 400, height = 400;
const unit = 40;
const xmin = -5, xmax = 5;
const ymin = -5, ymax = 5;

/* ====================== VARIABLES ====================== */
let m, p, k;
let solutionCanonique = "";
let solutionLatex = "";

/* ====================== OUTILS ====================== */
function xToPx(x){ return width/2 + x*unit; }
function yToPx(y){ return height/2 - y*unit; }

function randInt(min,max){
  return Math.floor(Math.random()*(max-min+1))+min;
}
function randNonZero(min,max){
  let x;
  do{x=randInt(min,max);}while(x===0);
  return x;
}

  // GÃ©nÃ¨re une fraction parmi une liste, avec signe Â±
function randFraction(liste){
  const frac = liste[Math.floor(Math.random() * liste.length)];
  const signe = Math.random() < 0.5 ? 1 : -1;
  return signe * frac;
}
const M_POSSIBLES = [
  -3, -2, -1, 1, 2, 3,
  1/2, 1/3, 1/4, 2/3, 3/2, 3/4,
  -1/2, -1/3, -1/4, -2/3, -3/2, -3/4
];

const P_POSSIBLES = [
  -4, -3, -2, -1, 1, 2, 3, 4,
  1/2, 3/2, 5/2, 7/2,
  -1/2, -3/2, -5/2, -7/2
];


function nettoyer(s){
  return s.toLowerCase()
          .replace(/\s+/g,"")
          .replace(/âˆ’/g,"-");
}

  function randDansListe(liste){
  return liste[Math.floor(Math.random() * liste.length)];
}

  
// Pour la comparaison (texte Ã©lÃ¨ve)
function ecrireMxCanonique(m){
  if (m === 1) return "x";
  if (m === -1) return "-x";

  if (!Number.isInteger(m)) {
    const signe = m < 0 ? "-" : "";
    const abs = Math.abs(m);

    if (abs === 1/2) return `${signe}1/2x`;
    if (abs === 1/3) return `${signe}1/3x`;
    if (abs === 1/4) return `${signe}1/4x`;
    if (abs === 2/3) return `${signe}2/3x`;
    if (abs === 3/2) return `${signe}3/2x`;
    if (abs === 3/4) return `${signe}3/4x`;
  }

  return m + "x";
}

// Pour l'affichage MathJax
function ecrireMxLatex(m){
  if (m === 1) return "x";
  if (m === -1) return "-x";

  if (!Number.isInteger(m)) {
    const signe = m < 0 ? "-" : "";
    const abs = Math.abs(m);

    if (abs === 1/2) return `${signe}\\frac{1}{2}x`;
    if (abs === 1/3) return `${signe}\\frac{1}{3}x`;
    if (abs === 1/4) return `${signe}\\frac{1}{4}x`;
    if (abs === 2/3) return `${signe}\\frac{2}{3}x`;
    if (abs === 3/2) return `${signe}\\frac{3}{2}x`;
    if (abs === 3/4) return `${signe}\\frac{3}{4}x`;
  }

  return m + "x";
}


function ecrirePCanonique(p){
  if (Number.isInteger(p)) {
    return p > 0 ? `+${p}` : `${p}`;
  }

  const signe = p < 0 ? "-" : "+";
  const abs = Math.abs(p);

  if (abs === 1/2) return `${signe}1/2`;
  if (abs === 3/2) return `${signe}3/2`;
  if (abs === 5/2) return `${signe}5/2`;
  if (abs === 7/2) return `${signe}7/2`;
}


function ecrirePLatex(p){
  const signe = p < 0 ? "-" : "+";
  const abs = Math.abs(p);

  if (!Number.isInteger(p)) {
    if (abs === 1/2) return `${signe}\\frac{1}{2}`;
    if (abs === 3/2) return `${signe}\\frac{3}{2}`;
    if (abs === 5/2) return `${signe}\\frac{5}{2}`;
    if (abs === 7/2) return `${signe}\\frac{7}{2}`;
  }
}



  
function dessinerPoint(x, y){
  const cx = xToPx(x);
  const cy = yToPx(y);

  svg.innerHTML += `
    <circle cx="${cx}" cy="${cy}" r="5" fill="#0b3c5d" />
  `;
}

function tracerSegmentPointille(x1, y1, x2, y2){
  svg.innerHTML += `
    <line x1="${xToPx(x1)}" y1="${yToPx(y1)}"
          x2="${xToPx(x2)}" y2="${yToPx(y2)}"
          stroke="#0b3c5d"
          stroke-width="2"
          stroke-dasharray="5,5"/>
  `;
}

function afficherPointsCorrection(){

  // ----- DROITES y = mx ou y = mx + p -----
  if (solutionCanonique.startsWith("y=") && solutionCanonique.includes("x")) {

    const xA = 0;
    const yA = p || 0;

    const xB = 1;
    const yB = m + (p || 0);

    // points
    dessinerPoint(xA, yA);
    dessinerPoint(xB, yB);

    // segments pÃ©dagogiques
    tracerSegmentPointille(xA, yA, xB, yA); // horizontal
    tracerSegmentPointille(xB, yA, xB, yB); // vertical
    // Texte de la pente
const dy = m;
const dx = 1;

// Position du texte (prÃ¨s des segments)
ecrireTexteSVG(
  1.2,
  (p || 0) + m/2,
  `m = Î”y/Î”x = ${ecrireFractionTexte(dy)}/${dx}`
);

    // Texte pour p (ordonnÃ©e Ã  l'origine)
if (typeof p !== "undefined") {
  ecrireTexteSVG(
    -0.8,
    p,
    `p = ${ecrireFractionTexte(p)}`
  );
}

  }

  // ----- DROITE y = k -----
  else if (solutionCanonique.startsWith("y=")) {
    dessinerPoint(0, k);
    dessinerPoint(1, k);
  }

  // ----- DROITE x = k -----
  else if (solutionCanonique.startsWith("x=")) {
    dessinerPoint(k, 0);
    dessinerPoint(k, 1);
  }
}


  function relierPoints(x1,y1,x2,y2){
  svg.innerHTML += `
    <line x1="${xToPx(x1)}" y1="${yToPx(y1)}"
          x2="${xToPx(x2)}" y2="${yToPx(y2)}"
          stroke="#0d6efd" stroke-dasharray="4"/>
  `;
}

  function ecrireFractionTexte(val){
  if (Number.isInteger(val)) return val;

  const abs = Math.abs(val);
  const signe = val < 0 ? "-" : "";

  if (abs === 1/2) return signe + "1/2";
  if (abs === 1/3) return signe + "1/3";
  if (abs === 1/4) return signe + "1/4";
  if (abs === 2/3) return signe + "2/3";
  if (abs === 3/2) return signe + "3/2";
  if (abs === 3/4) return signe + "3/4";
  if (abs === 5/2) return signe + "5/2";
  if (abs === 7/2) return signe + "7/2";

  return val;
}

  
function ecrireTexteSVG(x, y, texte){
  svg.innerHTML += `
    <text x="${xToPx(x)}" y="${yToPx(y)}"
          font-size="14"
          fill="#0b3c5d">
      ${texte}
    </text>
  `;
}
  
function afficherCorrection(){
  const fb = document.getElementById("feedback");

  fb.classList.remove("visible");

  fb.innerHTML = `
    <span style="color:#000;">
      ðŸ“˜ <strong>Correction</strong><br>
      \\( ${solutionLatex} \\)
    </span>
  `;

  MathJax.typesetClear([fb]);
  MathJax.typesetPromise([fb]).then(() => {
    setTimeout(() => fb.classList.add("visible"), 50);
  });

  afficherPointsCorrection();
}


  
/* ====================== REPERE ====================== */
function dessinerRepere(){
  svg.innerHTML="";

  for(let x=xmin;x<=xmax;x++){
    svg.innerHTML+=`<line x1="${xToPx(x)}" y1="0" x2="${xToPx(x)}" y2="${height}" stroke="#ddd"/>`;
  }
  for(let y=ymin;y<=ymax;y++){
    svg.innerHTML+=`<line x1="0" y1="${yToPx(y)}" x2="${width}" y2="${yToPx(y)}" stroke="#ddd"/>`;
  }

  svg.innerHTML+=`
    <line x1="0" y1="${height/2}" x2="${width}" y2="${height/2}" stroke="black" stroke-width="2"/>
    <line x1="${width/2}" y1="0" x2="${width/2}" y2="${height}" stroke="black" stroke-width="2"/>
  `;

  for(let x=xmin;x<=xmax;x++) if(x!==0)
    svg.innerHTML+=`<text x="${xToPx(x)+2}" y="${height/2+14}" font-size="12">${x}</text>`;

  for(let y=ymin;y<=ymax;y++) if(y!==0)
    svg.innerHTML+=`<text x="${width/2+6}" y="${yToPx(y)+4}" font-size="12">${y}</text>`;
}

/* ====================== DROITE ====================== */
function tracer(type){
if(type==="x=k"){
  svg.innerHTML+=`<line x1="${xToPx(k)}" y1="0" x2="${xToPx(k)}" y2="${height}"
                       stroke="#FFA372" stroke-width="3"/>`;
}
if(type==="y=k"){
  svg.innerHTML+=`<line x1="0" y1="${yToPx(k)}" x2="${width}" y2="${yToPx(k)}"
                       stroke="#FFA372" stroke-width="3"/>`;
}
  if(type==="y=mx"||type==="y=mx+p"){
    const x1=xmin,y1=m*x1+(p||0);
    const x2=xmax,y2=m*x2+(p||0);
    svg.innerHTML+=`
      <line x1="${xToPx(x1)}" y1="${yToPx(y1)}"
            x2="${xToPx(x2)}" y2="${yToPx(y2)}"
            stroke="#FFA372"
            stroke-width="3"/>
    `;
  }
}

/* ====================== GENERATION ====================== */
function genererExercice(){
  document.getElementById("feedback").innerHTML="";
  document.getElementById("reponse").value="";

  dessinerRepere();
  const r=Math.random();

if(r < 0.2){
  m = randDansListe(M_POSSIBLES);
  solutionCanonique = `y=${ecrireMxCanonique(m)}`;
  solutionLatex     = `y=${ecrireMxLatex(m)}`;
  tracer("y=mx");
}
else if(r < 0.6){
  m = randDansListe(M_POSSIBLES);
  p = randDansListe(P_POSSIBLES);

  solutionCanonique =
    `y=${ecrireMxCanonique(m)}${ecrirePCanonique(p)}`;

  solutionLatex =
    `y=${ecrireMxLatex(m)}${ecrirePLatex(p)}`;

  tracer("y=mx+p");
}
  else if(r<0.8){
    k=randInt(-4,4);
    solutionCanonique=`x=${k}`;
    solutionLatex=`x=${k}`;
    tracer("x=k");
  }
  else{
    k=randInt(-4,4);
    solutionCanonique=`y=${k}`;
    solutionLatex=`y=${k}`;
    tracer("y=k");
  }
}

/* ====================== VERIFICATION ====================== */
function verifier(){
  const input = document.getElementById("reponse");
  const repBrute = input.value;

  // ðŸ‘‰ SI RIEN N'EST ECRIT : ON NE FAIT RIEN
  if (!repBrute || repBrute.trim() === "") {
    return;
  }

  const rep = nettoyer(repBrute);
  const sol = nettoyer(solutionCanonique);
  const fb = document.getElementById("feedback");

  if(rep === sol){
    fb.innerHTML = "âœ… Bonne rÃ©ponse !";
  } else {
    fb.innerHTML = `
      âŒ RÃ©ponse incorrecte<br>`;
    MathJax.typesetClear([fb]);
    MathJax.typesetPromise([fb]);
  }
}



window.onload = genererExercice;
console.log("JS chargÃ© sans erreur");

</script>

<script src="../../../js/protection.js"></script>
</body>
</html>

