<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<!-- CSS -->
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- MathJax v3 -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>


<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="equation"></div>

  <!-- QCM -->
<div id="qcm" class="qcm-grid">
  <div class="qcm-card" onclick="verifier('linéaire', this)">Fonction linéaire</div>
  <div class="qcm-card" onclick="verifier('affine', this)">Fonction affine</div>
  <div class="qcm-card" onclick="verifier('constante', this)">Fonction constante</div>
  <div class="qcm-card" onclick="verifier('pasfonction', this)">Pas une fonction</div>
</div>


<div class="center-button">
  <button onclick="genererEquation()">Nouvel exercice</button>
</div>



  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
/* ====================== OUTILS MATHJAX ====================== */
function renderMath(el){
  MathJax.typesetClear([el]);
  MathJax.typesetPromise([el]);
}

// ====================== PARAMETRES ======================
const PROBA_LINEAIRE   = 0.25;   // y = mx
const PROBA_OBLIQUE    = 0.25;   // y = mx + p
const PROBA_VERTICALE  = 0.25;   // x = k

/* ====================== VARIABLES ====================== */
let m, p, k;
let typeEquation = ""; // pour stocker le type correct
let equationTextePourCorrection = "";

/* ====================== UTILITAIRES ====================== */
function randCoeff(){ return Math.floor(Math.random()*41)-20; }
function randCoeffNonZero(){ let x; do{x=randCoeff();}while(x===0); return x; }

/* ====================== GENERATION ====================== */
function genererEquation(){
  // Réinitialiser les cartes si elles existent
  const cards = document.querySelectorAll('.qcm-card');
  cards.forEach(card => {
    card.classList.remove('correct', 'incorrect');
    card.style.pointerEvents = "auto"; // rendre à nouveau cliquables
  });

  const tirage = Math.random();
  let terms = [];

  /* CAS 1 : DROITE LINEAIRE y = mx */
  if (tirage < PROBA_LINEAIRE) {
    m = randCoeffNonZero();
    terms.push((m === 1 ? '' : (m === -1 ? '-' : m)) + 'x');
    equationTextePourCorrection = "y = " + terms.join(' ');
    typeEquation = "linéaire";
  }
  /* CAS 2 : DROITE OBLIQUE y = mx + p */
  else if (tirage < PROBA_LINEAIRE + PROBA_OBLIQUE) {
    m = randCoeffNonZero();
    p = randCoeffNonZero();
    terms.push((m === 1 ? '' : (m === -1 ? '-' : m)) + 'x');
    if (p !== 0) terms.push((p > 0 ? '+ ' : '- ') + Math.abs(p));
    equationTextePourCorrection = "y = " + terms.join(' ');
    typeEquation = "affine";
  }
  /* CAS 3 : DROITE VERTICALE x = k */
  else if (tirage < PROBA_LINEAIRE + PROBA_OBLIQUE + PROBA_VERTICALE) {
    k = randCoeff();
    equationTextePourCorrection = "x = " + k;
    typeEquation = "pasfonction";
  }
  /* CAS 4 : DROITE HORIZONTALE y = k */
  else {
    k = randCoeff();
    equationTextePourCorrection = "y = " + k;
    typeEquation = "constante";
  }

  const eqDiv = document.getElementById("equation");
  eqDiv.innerHTML = `Type de fonction ? <br> \\(${equationTextePourCorrection}\\)`;
  renderMath(eqDiv);
}


/* ====================== VERIFICATION ====================== */
function verifier(reponseEleve, element) {
  // Désactiver toutes les cartes pour éviter plusieurs clics
  const cards = document.querySelectorAll('.qcm-card');
  cards.forEach(card => card.style.pointerEvents = "none");

  if (reponseEleve === typeEquation) {
    element.classList.add('correct');
  } else {
    element.classList.add('incorrect');
    // Facultatif : montrer la bonne réponse en vert
    const bonneCarte = Array.from(cards).find(c => {
      return (typeEquation === "linéaire" && c.innerText.includes("linéaire")) ||
             (typeEquation === "affine" && c.innerText.includes("affine")) ||
             (typeEquation === "constante" && c.innerText.includes("constante")) ||
             (typeEquation === "pasfonction" && c.innerText.includes("Pas"));
    });
    if (bonneCarte) bonneCarte.classList.add('correct');
  }
}


// Générer le premier exercice au chargement
window.onload = genererEquation;
</script>
   
  <!-- Protection clique droit (commun à tout le site) -->
  <script src="../../../js/protection.js"></script>
  
</body>
</html>
