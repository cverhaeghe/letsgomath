<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Dancing+Script:wght@400..700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">

<!-- CSS -->
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- MathJax -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="equation"></div>

  <input type="text" id="reponse" placeholder="">

  <button onclick="verifier()">V√©rifier ma r√©ponse</button>
  <button onclick="corriger()">Correction</button>
  <button onclick="genererEquation()">Nouvel exercice</button>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
// ====================== PARAMETRES PEDAGOGIQUES ======================
// Somme = 1
const PROBA_OBLIQUE     = 0.1;   // y = mx + p
const PROBA_VERTICALE   = 0.9;  // x = k
// le reste = horizontale (y = k)

// ====================== VARIABLES ======================
let a, b, c;
let coeffA, coeffB;
let equationTextePourCorrection = "";

// ====================== UTILITAIRES ======================
function pgcd(x, y){
  while(y!==0){ let t=y; y=x%y; x=t; }
  return Math.abs(x);
}

function fractionLaTeX(num, den){
  if(num === 0) return "0";
  if(den === 1) return num.toString();
  return (num < 0 ? "-" : "") + `\\frac{${Math.abs(num)}}{${den}}`;
}

// ====================== GENERATION ======================
function randCoeff(){ return Math.floor(Math.random()*41)-20; }
function randCoeffNonZero(){ let x; do{x=randCoeff();}while(x===0); return x; }

function genererEquation(){
  const tirage = Math.random();

  if(tirage < PROBA_OBLIQUE){
    // droite oblique
    do{ a=randCoeff(); b=randCoeff(); }while(a===0 || b===0);
  }
  else if(tirage < PROBA_OBLIQUE + PROBA_VERTICALE){
    // droite verticale
    a = randCoeffNonZero();
    b = 0;
  }
  else{
    // droite horizontale
    a = 0;
    b = randCoeffNonZero();
  }

  c = randCoeff();

  // Construction texte √©quation (sans 1x)
  let terms=[];
  if(a !== 0){
      terms.push((a === 1 ? '' : (a === -1 ? '-' : a)) + 'x');
}
  if(b !== 0){
    let signe = (terms.length > 0 ? (b > 0 ? '+' : '-') : (b < 0 ? '-' : ''));
    let valeur = Math.abs(b) === 1 ? 'y' : Math.abs(b) + 'y';
    terms.push(signe + valeur);
}
  if(c !== 0){
    let signe = (terms.length > 0 ? (c > 0 ? '+' : '-') : (c < 0 ? '-' : ''));
    terms.push(signe + Math.abs(c));
}

let equationTextePourCorrection = terms.join(' ').replace(/\+\s-/g,'- ').replace(/^\+\s*/, '');
document.getElementById("equation").innerHTML =
    `R√©duis l‚Äô√©quation de la droite : \\(${equationTextePourCorrection} = 0\\).`;

  document.getElementById("reponse").value='';
  document.getElementById("feedback").innerHTML='';

  if(b!==0){
    let p1 = pgcd(a, Math.abs(b));
    let p2 = pgcd(c, Math.abs(b));
    coeffA = {num: -a/p1, den: Math.abs(b)/p1};
    coeffB = {num: -c/p2, den: Math.abs(b)/p2};
  }

  MathJax.typeset();
}

// ====================== VERIFICATION ======================
function lireReponse(){
  return document.getElementById("reponse").value.toLowerCase().replace(/\s/g,'');
}

function verifier(){
  const r = lireReponse();
  const feedback = document.getElementById("feedback");

  if(b===0){
    let x = -c / a;
    feedback.innerHTML = (r === `x=${x}`) ? "‚úÖ Correct !" : "‚ùå Incorrect.";
    feedback.style.color = (r === `x=${x}`) ? "green" : "red";
    return;
  }

  if(a===0){
    let y = -c / b;
    feedback.innerHTML = (r === `y=${y}`) ? "‚úÖ Correct !" : "‚ùå Incorrect.";
    feedback.style.color = (r === `y=${y}`) ? "green" : "red";
    return;
  }

  const forme = `${fractionLaTeX(coeffA.num, coeffA.den)}x ${fractionLaTeX(coeffB.num, coeffB.den)}`;
  feedback.innerHTML = (r===forme) ? "‚úÖ Correct !" : "‚ùå Incorrect.";
  feedback.style.color = (r===forme) ? "green" : "red";
}

// ====================== CORRECTION ======================
function corriger(){
  const f = document.getElementById("feedback");
  f.style.color = "#000"; // toujours noir

// --- Cas vertical ---
if(b === 0){
  let texte = `üìò <strong>Correction d√©taill√©e</strong><br><br>
    \\(${equationTextePourCorrection}=0\\)<br><br>`;

  // a = ¬±1 ‚Üí x isol√© directement
  if(Math.abs(a) === 1){
    if(a === 1){
      texte += `On a : \\(x = ${-c}\\)`;
    } else {
      texte += `On passe le terme en x √† droite : \\(${c} = x\\)`;
    }
  } 
  else {
    // a ‚â† ¬±1 ‚Üí fraction simplifi√©e
    if(a > 0){
      let xFrac = fractionLaTeX(-c, a);
      texte += `On isole le terme en x :<br>
        \\(${a}x = ${-c}\\)<br><br>
        On divise tout par ${a} :<br>
        \\(x = ${xFrac}\\)`;
    } else {
      let xFrac = fractionLaTeX(c, -a);
      texte += `Le coefficient de x est n√©gatif, on passe le terme en x √† droite :<br>
        \\(${c} = ${Math.abs(a)}x\\)<br><br>
        On divise tout par ${Math.abs(a)} :<br>
        \\(x = ${xFrac}\\)`;
    }
  }

  f.innerHTML = texte;
  f.style.color = "#000";
  MathJax.typeset();
  return;
}


  // --- Cas horizontal ---
  if(a === 0){
    let texte = `üìò <strong>Correction d√©taill√©e</strong><br><br>
      \\(${equationTextePourCorrection}=0\\)<br><br>`;

    // b = ¬±1 ‚Üí y isol√© directement
    if(Math.abs(b) === 1){
      if(b === 1){
        texte += `On a : \\(y = ${-c}\\)`;
      } else {
        texte += `On a : \\(${c} = y\\)`;
      }
    } else {
      // b ‚â† ¬±1 ‚Üí fraction simplifi√©e
      if(b > 0){
        let yFrac = fractionLaTeX(-c, b);
        texte += `On isole le terme en y :<br>
          \\(${b}y = ${-c}\\)<br><br>
          On divise tout par ${b} :<br>
          \\(y = ${yFrac}\\)`;
      } else {
        let yFrac = fractionLaTeX(-c, -b);
        texte += `Le coefficient de y est n√©gatif, on passe le terme en y √† droite :<br>
          \\(${c} = ${Math.abs(b)}y\\)<br><br>
          On divise tout par ${Math.abs(b)} :<br>
          \\(y = ${yFrac}\\)`;
      }
    }

    f.innerHTML = texte;
    MathJax.typeset();
    return;
  }

  // --- Cas g√©n√©ral ---
  let axTxt = (a === 1 ? 'x' : (a === -1 ? '-x' : a+'x'));
  let cTxt  = (c < 0 ? '- '+Math.abs(c) : '+ '+c);

  let texte = `üìò <strong>Correction d√©taill√©e</strong><br><br>
      \\(${equationTextePourCorrection}=0\\)<br><br>`;

  // b = ¬±1 ‚Üí y isol√© directement
  if(Math.abs(b) === 1){
    if(b === 1){
      texte += `On isole y : \\(y = -${axTxt} ${c < 0 ? '- '+Math.abs(c) : '+ '+c}\\)`;
    } else {
      texte += `On passe le terme en y √† droite : \\(${axTxt} ${cTxt} = y\\)`;
    }
  } else {
    if(b > 0){
      texte += `On isole le terme en y :<br>
        \\(${b}y = -${axTxt} ${cTxt}\\)<br><br>
        On divise tout par ${b} :<br>
        \\(y = ${fractionLaTeX(coeffA.num, coeffA.den)}x ${fractionLaTeX(coeffB.num, coeffB.den)}\\)`;
    } else {
      texte += `Le coefficient de y est n√©gatif, on passe le terme en y √† droite :<br>
        \\(${axTxt} ${cTxt} = ${Math.abs(b)}y\\)<br><br>
        On divise tout par ${Math.abs(b)} :<br>
        \\(y = ${fractionLaTeX(coeffA.num, coeffA.den)}x ${fractionLaTeX(coeffB.num, coeffB.den)}\\)`;
    }
  }

  f.innerHTML = texte;
  MathJax.typeset();
}


// ====================== INITIALISATION ======================
genererEquation();
</script>

</body>
</html>
