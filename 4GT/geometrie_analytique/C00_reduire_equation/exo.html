<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Dancing+Script:wght@400..700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

<!-- CSS -->
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- MathJax -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="equation"></div>

  <input type="text" id="reponse" placeholder="">

  <button onclick="verifier()">V√©rifier ma r√©ponse</button>
  <button onclick="corriger()">Correction</button>
  <button onclick="genererEquation()">Nouvel exercice</button>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html"> Retour au menu</a>
  </div>
</div>

<script>
// ====================== VARIABLES ======================
let a, b, c;
let coeffA, coeffB;
let equationTextePourCorrection = "";

// ====================== UTILITAIRES ======================
function pgcd(x, y){ while(y!==0){ let t=y; y=x%y; x=t;} return Math.abs(x); }
function fractionLaTeX(num, den){
  if(num === 0) return "0";
  let signeFrac = num < 0 ? "-" : "";
  return `${signeFrac}\\frac{${Math.abs(num)}}{${den}}`;
}

// ====================== GENERATION ======================
function randCoeff(){ return Math.floor(Math.random()*41)-20; } // -20 √† 20
function randCoeffNonZero(){ let x; do{x=randCoeff();}while(x===0); return x; }

// G√©n√©ration de l‚Äô√©quation
function genererEquation(){
  const tirage = Math.random();

  if(tirage < 0.7){
    do{ a=randCoeff(); b=randCoeff(); }while(a===0 || b===0);
  } else if(tirage < 0.85){
    a = randCoeffNonZero(); b = 0;
  } else{
    a = 0; b = randCoeffNonZero();
  }

  c = randCoeffNonZero();

  // Construction texte √©quation pour l'affichage
  let terms=[];
  if(a!==0) terms.push((a===1?'':'') + (a===-1?'-':'') + 'x');
  if(b!==0) terms.push((b>0?'+ ':'- ') + (Math.abs(b)===1?'y':Math.abs(b)+'y'));
  if(c!==0) terms.push((c>0?'+ ':'- ') + Math.abs(c));

  equationTextePourCorrection = terms.join(' ').replace(/\+\s-/g,'- ');
  document.getElementById("equation").innerHTML=`R√©duis l‚Äô√©quation de la droite : \\(${equationTextePourCorrection} = 0\\).`;

  document.getElementById("reponse").value='';
  document.getElementById("feedback").innerHTML='';

  // Pr√©parer coefficients pour y = mx+p
  if(b!==0){
    let p1 = pgcd(a,b);
    let p2 = pgcd(c,b);
    coeffA = {num: -a/p1, den: b/p1};
    coeffB = {num: -c/p2, den: b/p2};
  }

  MathJax.typeset();
}

// ====================== VERIFICATION ======================
function lireReponse(){ return document.getElementById("reponse").value.toLowerCase().replace(/\s/g,''); }

function verifier(){
  const r = lireReponse();
  const feedback = document.getElementById("feedback");

  if(b===0){
    let p = pgcd(c,a), num = -c/p, den = a/p;
    const formeSimplifiee = `x=${num}/${den}`;
    const formeNonSimplifiee = `x=${-c}/${a}`;
    if(r===formeSimplifiee){feedback.innerHTML="‚úÖ Correct !"; feedback.style.color="green";}
    else if(r===formeNonSimplifiee){feedback.innerHTML="üü† Presque‚Ä¶ fraction √† simplifier."; feedback.style.color="orange";}
    else{feedback.innerHTML="‚ùå Incorrect."; feedback.style.color="red";}
    return;
  }

  if(a===0){
    let p = pgcd(c,b), num=-c/p, den=b/p;
    const formeSimplifiee = `y=${num}/${den}`;
    const formeNonSimplifiee = `y=${-c}/${b}`;
    if(r===formeSimplifiee){feedback.innerHTML="‚úÖ Correct !"; feedback.style.color="green";}
    else if(r===formeNonSimplifiee){feedback.innerHTML="üü† Presque‚Ä¶ fraction √† simplifier."; feedback.style.color="orange";}
    else{feedback.innerHTML="‚ùå Incorrect."; feedback.style.color="red";}
    return;
  }

  const formeSimplifiee = `${fractionLaTeX(coeffA.num, coeffA.den)}x ${fractionLaTeX(coeffB.num, coeffB.den)}`;
  const formeNonSimplifiee = `${-a}/${b}x ${-c<0?'':'+'}${-c}/${b}`;

  if(r===formeSimplifiee){feedback.innerHTML="‚úÖ Correct !"; feedback.style.color="green";}
  else if(r===formeNonSimplifiee){feedback.innerHTML="üü† Presque‚Ä¶ fraction √† simplifier."; feedback.style.color="orange";}
  else{feedback.innerHTML="‚ùå Incorrect."; feedback.style.color="red";}
}

// ====================== CORRECTION ======================
function corriger(){
  const feedback = document.getElementById("feedback");

  if(b===0){
    feedback.innerHTML=`üìò <strong>Correction</strong><br><br>
      \\(${equationTextePourCorrection} = 0\\)<br>
      On isole x : \\(x = -\\frac{${c}}{${a}}\\)<br>
      Fraction simplifi√©e : \\(x = ${fractionLaTeX(-c, a)}\\)`;
    feedback.style.color="#000"; MathJax.typeset(); return;
  }

  if(a===0){
    feedback.innerHTML=`üìò <strong>Correction</strong><br><br>
      \\(${equationTextePourCorrection} = 0\\)<br>
      On isole y : \\(y = -\\frac{${c}}{${b}}\\)<br>
      Fraction simplifi√©e : \\(y = ${fractionLaTeX(-c,b)}\\)`;
    feedback.style.color="#000"; MathJax.typeset(); return;
  }

  // Cas g√©n√©ral
  let correction=`üìò <strong>Correction d√©taill√©e</strong><br><br>
    \\(${equationTextePourCorrection} = 0\\)<br><br>`;

  // Passage √† y = ...
  let signeA = coeffA.num < 0 ? "-" : "+";
  let signeB = coeffB.num < 0 ? "-" : "+";

  correction += `\\(${b}y = ${-a}x ${-c<0?'+':'-'} ${Math.abs(c)}\\)<br>
                 \\(y = ${fractionLaTeX(coeffA.num, coeffA.den)}x ${fractionLaTeX(coeffB.num, coeffB.den)}\\)`;

  feedback.innerHTML = correction;
  feedback.style.color="#000"; MathJax.typeset();
}

// ====================== INITIALISATION ======================
genererEquation();
</script>

</body>
</html>

