<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<!-- CSS -->
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- MathJax v3 -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="equation"></div>

  <input type="text" id="reponse" placeholder="">

  <button onclick="verifier()">V√©rifier</button>
  <button onclick="corriger()">Correction</button>
  <button onclick="genererEquation()">Nouvel exercice</button>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
/* ====================== OUTILS MATHJAX ====================== */
function renderMath(el){
  MathJax.typesetClear([el]);
  MathJax.typesetPromise([el]);
}
// ====================== PARAMETRES PEDAGOGIQUES ======================
// Somme = 1
const PROBA_OBLIQUE     = 0.6;   // y = mx + p
const PROBA_VERTICALE   = 0.2;  // x = k
// le reste = horizontale (y = k)

/* ====================== VARIABLES ====================== */
let a, b, c;
let equationTextePourCorrection = "";

/* ====================== UTILITAIRES ====================== */
function randCoeff(){ return Math.floor(Math.random()*41)-20; }
function randCoeffNonZero(){ let x; do{x=randCoeff();}while(x===0); return x; }
function randCoeffNonZeroNotOne() {let x; do{x=randCoeff();}while(x === 0 || x === 1 || x === -1); return x; }
function randCoeffNotOne() {let x; do{x=randCoeff();}while(x === 1 || x === -1); return x; }

function pgcd(x, y){
  x = Math.abs(x);
  y = Math.abs(y);
  while (y !== 0) {let t = y;y = x % y;x = t;}
  return x;
}

function FractionIrreductible(num, den) {
    const p = pgcd(num, den);
    return {
      num: num / p,
      den: den / p
      };
    }

function fractionLaTeX(num, den){
  if(num === 0) return "0";
  if(den === 1) return num.toString();
  return (num < 0 ? "-" : "") + `\\frac{${Math.abs(num)}}{${den}}`;
}

/* ====================== 
      GENERATION 
====================== */

function genererEquation(){

  const tirage = Math.random();

  let terms = [];

  /* ====== CAS 1 : DROITE VERTICALE (TON CODE ACTUEL) ====== */
  if(tirage < PROBA_VERTICALE){

    a = randCoeffNonZeroNotOne();
    b = 0;
    c = randCoeffNonZero();

    terms.push((a === 1 ? '' : (a === -1 ? '-' : a)) + 'x');
    if(c !== 0){
      terms.push((c > 0 ? '+ ' : '- ') + Math.abs(c));
    }
  }

  /* ====== CAS 2 : DROITE OBLIQUE ====== */
  else if(tirage < PROBA_VERTICALE + PROBA_OBLIQUE){

  
      a = randCoeffNonZeroNotOne();
      b = randCoeffNonZeroNotOne();
      c = randCoeffNonZero();

    terms.push((a === 1 ? '' : (a === -1 ? '-' : a)) + 'x');
    terms.push((b > 0 ? '+ ' : '- ') + (Math.abs(b) === 1 ? 'y' : Math.abs(b) + 'y'));
    if(c !== 0){
      terms.push((c > 0 ? '+ ' : '- ') + Math.abs(c));
    }
  }

  /* ====== CAS 3 : DROITE HORIZONTALE ====== */
  else{

    a = 0;
    b = randCoeffNonZeroNotOne();
    c = randCoeffNonZero();

    terms.push((b > 0 ? '' : '-') + (Math.abs(b) === 1 ? 'y' : Math.abs(b) + 'y'));
    if(c !== 0){
      terms.push((c > 0 ? '+ ' : '- ') + Math.abs(c));
    }
  }

  equationTextePourCorrection = terms.join(' ')
    .replace(/\+\s-/g,'- ')
    .replace(/^\+\s*/,'');

  const eqDiv = document.getElementById("equation");
  eqDiv.innerHTML =
    `R√©duis l‚Äô√©quation de la droite : \\(${equationTextePourCorrection} = 0\\).`;
  renderMath(eqDiv);

  document.getElementById("reponse").value = "";
  document.getElementById("feedback").innerHTML = "";
}

  
/* ======================
OUTILS POUR VERIFICATION
====================== */

function parseFraction(txt) {
  if (!txt) return null;
  if (txt.includes("/")) {
    const [n, d] = txt.split("/");
    if (d === "0") return null;
    return { num: parseInt(n), den: parseInt(d) };
  }
  return { num: parseInt(txt), den: 1 };
}

function parseReponse(txt) {
  txt = txt.replace(/\s+/g, "");

  let variable;
  if (txt.startsWith("x=")) variable = "x";
  else if (txt.startsWith("y=")) variable = "y";
  else return null;

  txt = txt.substring(2);

  // cas y = mx + p
  if (variable === "y" && txt.includes("x")) {
    const [mPart, pPartRaw] = txt.split("x");

    const mTxt =
      mPart === "" ? "1" :
      mPart === "-" ? "-1" :
      mPart;

    const pTxt =
      pPartRaw === "" ? "0" :
      pPartRaw.startsWith("+") ? pPartRaw.substring(1) :
      pPartRaw;

    const m = parseFraction(mTxt);
    const p = parseFraction(pTxt);

    if (!m || !p) return null;

    return { variable: "y", m, p };
  }

  // cas x = k ou y = k
  const val = parseFraction(txt);
  if (!val) return null;

  return { variable, valeur: val };
}

function memesValeurs(f1, f2) {
  return f1.num * f2.den === f2.num * f1.den;
}

/* ======================
SOLUTION OFFICIELLE
====================== */

function solutionOfficielle() {

  // verticale : ax + c = 0 ‚Üí x = -c/a
  if (b === 0) {
    return {
      type: "verticale",
      valeur: FractionIrreductible(-c, a)
    };
  }

  // horizontale : by + c = 0 ‚Üí y = -c/b
  if (a === 0) {
    return {
      type: "horizontale",
      valeur: FractionIrreductible(-c, b)
    };
  }

  // oblique : ax + by + c = 0 ‚Üí y = (-a/b)x + (-c/b)
  return {
    type: "oblique",
    m: FractionIrreductible(-a, b),
    p: FractionIrreductible(-c, b)
  };
}

/* ======================
        VERIFICATION
====================== */

function verifier() {

  const f = document.getElementById("feedback");
  const saisie = document.getElementById("reponse").value;

  const rep = parseReponse(saisie);
  const sol = solutionOfficielle();

  // format invalide
  if (!rep) {
    f.style.color = "red";
    f.innerHTML = "‚ùå Incorrect";
    return;
  }

  /* ===== DROITE VERTICALE ===== */
  if (sol.type === "verticale") {

    if (rep.variable !== "x" || !rep.valeur) {
      f.style.color = "red";
      f.innerHTML = "‚ùå Incorrect";
      return;
    }

    if (!memesValeurs(rep.valeur, sol.valeur)) {
      f.style.color = "red";
      f.innerHTML = "‚ùå Incorrect";
      return;
    }

    if (pgcd(rep.valeur.num, rep.valeur.den) !== 1) {
      f.style.color = "orange";
      f.innerHTML = "‚ö†Ô∏è Presque‚Ä¶ la fraction doit √™tre simplifi√©e";
      return;
    }
  }

  /* ===== DROITE HORIZONTALE ===== */
  else if (sol.type === "horizontale") {

    if (rep.variable !== "y" || !rep.valeur) {
      f.style.color = "red";
      f.innerHTML = "‚ùå Incorrect";
      return;
    }

    if (!memesValeurs(rep.valeur, sol.valeur)) {
      f.style.color = "red";
      f.innerHTML = "‚ùå Incorrect";
      return;
    }

    if (pgcd(rep.valeur.num, rep.valeur.den) !== 1) {
      f.style.color = "orange";
      f.innerHTML = "‚ö†Ô∏è Presque‚Ä¶ la fraction doit √™tre simplifi√©e";
      return;
    }
  }

  /* ===== DROITE OBLIQUE ===== */
  else {

    if (rep.variable !== "y" || !rep.m || !rep.p) {
      f.style.color = "red";
      f.innerHTML = "‚ùå Incorrect";
      return;
    }

    if (
      !memesValeurs(rep.m, sol.m) ||
      !memesValeurs(rep.p, sol.p)
    ) {
      f.style.color = "red";
      f.innerHTML = "‚ùå Incorrect";
      return;
    }

    if (
      pgcd(rep.m.num, rep.m.den) !== 1 ||
      pgcd(rep.p.num, rep.p.den) !== 1
    ) {
      f.style.color = "orange";
      f.innerHTML = "‚ö†Ô∏è Presque‚Ä¶ la fraction doit √™tre simplifi√©e";
      return;
    }
  }

  // tout est bon
  f.style.color = "green";
  f.innerHTML = "‚úÖ Correct";
}



/* ====================== 
        CORRECTION 
====================== */
  
function corriger(){

  const f = document.getElementById("feedback");
  f.style.color = "#000";

  let texte = `üìò <strong>Correction d√©taill√©e</strong><br><br>
  \\(${equationTextePourCorrection} = 0\\)<br><br>`;

  /* ====================== CAS 1 : verticale ====================== */
      
  if(b===0) {
    
  let num, den;

  if (a > 0 && c > 0) { 
    texte += `<u>√âtape 1</u> : on isole \\(${a}x\\) <br>
        \\(${a}x = ${-c}\\)<br><br>
        
    <u>√âtape 2</u> : on divise tout par ${a} <br>`;

    num = c;
    den = a;
    const frac1 = fractionLaTeX(den, den);
    const frac2 = fractionLaTeX(num, den);

    texte += `\\( ${frac1} x = - ${frac2}\\)<br><br>`;

    texte += `<u>√âtape 3</u> : on simplifie <br>`;
       
    let frac = FractionIrreductible(c, a);
    if (frac.den === 1) {
    texte += `\\(x = - ${frac.num}\\)`;
    } else {
    texte += `\\(x = -\\frac{${frac.num}}{${frac.den}}\\)`;
    }


    
  } else if (a > 0 && c < 0) {
    texte += `<u>√âtape 1</u> : on isole \\(${a}x\\) <br>
        \\(${a}x = ${-c}\\)<br><br>
        
    <u>√âtape 2</u> : on divise tout par ${a} <br>`;

    num = -c;
    den = a;
    const frac1 = fractionLaTeX(den, den);
    const frac2 = fractionLaTeX(num, den);

    texte += `\\( ${frac1} x = ${frac2}\\)<br><br>`;

    texte += `<u>√âtape 3</u> : on simplifie <br>`;
            
    let frac = FractionIrreductible(-c, a);
    if (frac.den === 1) {
    texte += `\\(x = ${frac.num}\\)`;
    } else {
    texte += `\\(x = \\frac{${frac.num}}{${frac.den}}\\)`;
    }

   
    
  } else if (a < 0 && c > 0) {
    texte += `<u>√âtape 1</u> : comme \\( ${a}<0 \\), on passe \\(${a}x\\) √† droite <br>
        \\(${c} = ${Math.abs(a)}x\\)<br><br>
        
    <u>√âtape 2</u> : on divise tout par ${-a} <br>`;

    num = c;
    den = -a;
    const frac1 = fractionLaTeX(num, den);
    const frac2 = fractionLaTeX(den, den);

    texte += `\\( ${frac1} = ${frac2} x \\)<br><br>`;

    texte += `<u>√âtape 3</u> : on simplifie <br>`;
            
    let frac = FractionIrreductible(c, -a);
    if (frac.den === 1) {
    texte += `\\(x = ${frac.num}\\)`;
    } else {
    texte += `\\(x = \\frac{${frac.num}}{${frac.den}}\\)`;
    }
  
  

  } else {
    texte += `<u>√âtape 1</u> : comme \\( ${a}<0 \\), on passe \\(${a}x\\) √† droite <br>
        \\(${c} = ${Math.abs(a)}x\\)<br><br>
        
    <u>√âtape 2</u> : on divise tout par ${-a} <br>`;

    num = -c;
    den = -a;
    const frac1 = fractionLaTeX(num, den);
    const frac2 = fractionLaTeX(den, den);

    texte += `\\( -${frac1} = ${frac2} x \\)<br><br>`;

    texte += `<u>√âtape 3</u> : on simplifie <br>`;
             
    let frac = FractionIrreductible(-c, -a);
    if (frac.den === 1) {
    texte += `\\(x = - ${frac.num}\\)`;
    } else {
    texte += `\\(x = -\\frac{${frac.num}}{${frac.den}}\\)`;
    }
  }
}  

    /* ====================== CAS 2 : horizontale ====================== */

if(a===0)  {
  
let num, den;

  if (b > 0 && c > 0) { 
    texte += `<u>√âtape 1</u> : on isole \\(${b}y\\) <br>
        \\(${b}y = ${-c}\\)<br><br>
        
    <u>√âtape 2</u> : on divise tout par ${b} <br>`;

    num = c;
    den = b;
    const frac1 = fractionLaTeX(den, den);
    const frac2 = fractionLaTeX(num, den);

    texte += `\\( ${frac1} y = - ${frac2}\\)<br><br>`;

    texte += `<u>√âtape 3</u> : on simplifie <br>`;
       
    let frac = FractionIrreductible(c, b);
    if (frac.den === 1) {
    texte += `\\(y = - ${frac.num}\\)`;
    } else {
    texte += `\\(y = -\\frac{${frac.num}}{${frac.den}}\\)`;
    }


    
  } else if (b > 0 && c < 0) {
    texte += `<u>√âtape 1</u> : on isole \\(${b}y\\) <br>
        \\(${b}y = ${-c}\\)<br><br>
        
    <u>√âtape 2</u> : on divise tout par ${b} <br>`;

    num = -c;
    den = b;
    const frac1 = fractionLaTeX(den, den);
    const frac2 = fractionLaTeX(num, den);

    texte += `\\( ${frac1} y = ${frac2}\\)<br><br>`;

    texte += `<u>√âtape 3</u> : on simplifie <br>`;
            
    let frac = FractionIrreductible(-c, b);
    if (frac.den === 1) {
    texte += `\\(y = ${frac.num}\\)`;
    } else {
    texte += `\\(y = \\frac{${frac.num}}{${frac.den}}\\)`;
    }

   
    
  } else if (b < 0 && c > 0) {
    texte += `<u>√âtape 1</u> : comme \\( ${b}<0 \\), on passe \\(${b}y\\) √† droite <br>
        \\(${c} = ${Math.abs(b)}y\\)<br><br>
        
    <u>√âtape 2</u> : on divise tout par ${-b} <br>`;

    num = c;
    den = -b;
    const frac1 = fractionLaTeX(num, den);
    const frac2 = fractionLaTeX(den, den);

    texte += `\\( ${frac1} = ${frac2} y \\)<br><br>`;

    texte += `<u>√âtape 3</u> : on simplifie <br>`;
            
    let frac = FractionIrreductible(c, -b);
    if (frac.den === 1) {
    texte += `\\(y = ${frac.num}\\)`;
    } else {
    texte += `\\(y = \\frac{${frac.num}}{${frac.den}}\\)`;
    }
  
  

  } else {
    texte += `<u>√âtape 1</u> : comme \\( ${b}<0 \\), on passe \\(${b}y\\) √† droite <br>
        \\(${c} = ${Math.abs(b)}y\\)<br><br>
        
    <u>√âtape 2</u> : on divise tout par ${-b} <br>`;

    num = -c;
    den = -b;
    const frac1 = fractionLaTeX(num, den);
    const frac2 = fractionLaTeX(den, den);

    texte += `\\( -${frac1} = ${frac2} y \\)<br><br>`;

    texte += `<u>√âtape 3</u> : on simplifie <br>`;
             
    let frac = FractionIrreductible(-c, -b);
    if (frac.den === 1) {
    texte += `\\(y = - ${frac.num}\\)`;
    } else {
    texte += `\\(y = -\\frac{${frac.num}}{${frac.den}}\\)`;
    }
  }
}  

    /* ====================== CAS 3 : oblique ====================== */

if(a!==0 && b!==0)  {
  
    let num, den;

if (b > 0 && a > 0 && c > 0) {                                   /* CAS 1 : y=mx+p  */
    texte += `<u>√âtape 1</u> : on isole \\(${b}y\\) <br>
        \\(${b}y = - ${a}x -${c}\\)<br><br>

        
    <u>√âtape 2</u> : on divise tout par ${b} <br>`;
    num1 = a;
    num2 = c;
    den = b;
    const frac1 = fractionLaTeX(den, den);
    const frac2 = fractionLaTeX(num1, den);
    const frac3 = fractionLaTeX(num2, den);
    texte += `\\( ${frac1} y = - ${frac2}x - ${frac3} \\)<br><br>`;

    
} else if (b > 0 && a > 0 && c < 0) {                        /* CAS 2 : y=mx+p  */
    texte += `<u>√âtape 1</u> : on isole \\(${b}y\\) <br>
        \\(${b}y = - ${a}x +${-c}\\)<br><br>

        
    <u>√âtape 2</u> : on divise tout par ${b} <br>`;
    num1 = a;
    num2 = -c;
    den = b;
    const frac1 = fractionLaTeX(den, den);
    const frac2 = fractionLaTeX(num1, den);
    const frac3 = fractionLaTeX(num2, den);
    texte += `\\( ${frac1} y = - ${frac2}x + ${frac3} \\)<br><br>`;


} else if (b > 0 && a < 0 && c > 0) {                        /* CAS 3 : y=mx+p  */
    texte += `<u>√âtape 1</u> : on isole \\(${b}y\\) <br>
        \\(${b}y =  ${-a}x -${c}\\)<br><br>

        
    <u>√âtape 2</u> : on divise tout par ${b} <br>`;
    num1 = -a;
    num2 = c;
    den = b;
    const frac1 = fractionLaTeX(den, den);
    const frac2 = fractionLaTeX(num1, den);
    const frac3 = fractionLaTeX(num2, den);
    texte += `\\( ${frac1} y = ${frac2}x - ${frac3} \\)<br><br>`;



} else if (b > 0 && a < 0 && c < 0) {                        /* CAS 4 : y=mx+p  */
    texte += `<u>√âtape 1</u> : on isole \\(${b}y\\) <br>
        \\(${b}y = ${-a}x +${-c}\\)<br><br>

        
    <u>√âtape 2</u> : on divise tout par ${b} <br>`;
    num1 = -a;
    num2 = -c;
    den = b;
    const frac1 = fractionLaTeX(den, den);
    const frac2 = fractionLaTeX(num1, den);
    const frac3 = fractionLaTeX(num2, den);
    texte += `\\( ${frac1} y = ${frac2}x + ${frac3} \\)<br><br>`;



} else if (b < 0 && a > 0 && c > 0) {                        /* CAS 5 : y=mx+p  */
    texte += `<u>√âtape 1</u> : comme \\( ${b}<0 \\), on passe \\(${b}y\\) √† droite <br>
        \\(${a}x + ${c} = ${Math.abs(b)}y\\)<br><br>

        
    <u>√âtape 2</u> : on divise tout par ${-b} <br>`;
    num1 = a;
    num2 = c;
    den = -b;
    const frac1 = fractionLaTeX(num1, den);
    const frac2 = fractionLaTeX(num2, den);
    const frac3 = fractionLaTeX(den, den);
    texte += `\\( ${frac1} x + ${frac2}  = ${frac3} y \\)<br><br>`;



} else if (b < 0 && a > 0 && c < 0) {                        /* CAS 6 : y=mx+p  */
    texte += `<u>√âtape 1</u> : comme \\( ${b}<0 \\), on passe \\(${b}y\\) √† droite <br>
        \\(${a}x - ${-c} = ${Math.abs(b)}y\\)<br><br>
        
    <u>√âtape 2</u> : on divise tout par ${-b} <br>`;
    num1 = a;
    num2 = -c;
    den = -b;
    const frac1 = fractionLaTeX(num1, den);
    const frac2 = fractionLaTeX(num2, den);
    const frac3 = fractionLaTeX(den, den);
    texte += `\\( ${frac1} x - ${frac2}  = ${frac3} y \\)<br><br>`;


} else if (b < 0 && a < 0 && c > 0) {                        /* CAS 7 : y=mx+p  */
    texte += `<u>√âtape 1</u> : comme \\( ${b}<0 \\), on passe \\(${b}y\\) √† droite <br>
        \\(${a}x + ${c} = ${Math.abs(b)}y\\)<br><br>
        
    <u>√âtape 2</u> : on divise tout par ${-b} <br>`;
    num1 = -a;
    num2 = c;
    den = -b;
    const frac1 = fractionLaTeX(num1, den);
    const frac2 = fractionLaTeX(num2, den);
    const frac3 = fractionLaTeX(den, den);
    texte += `\\( -${frac1} x + ${frac2}  = ${frac3} y \\)<br><br>`;


    
 } else {                                           /* CAS 8 : y=mx+p  */

    texte += `<u>√âtape 1</u> : comme \\( ${b}<0 \\), on passe \\(${b}y\\) √† droite <br>
        \\(${a}x - ${-c} = ${Math.abs(b)}y\\)<br><br>
        
    <u>√âtape 2</u> : on divise tout par ${-b} <br>`;
    num1 = -a;
    num2 = -c;
    den = -b;
    const frac1 = fractionLaTeX(num1, den);
    const frac2 = fractionLaTeX(num2, den);
    const frac3 = fractionLaTeX(den, den);
    texte += `\\( -${frac1} x - ${frac2}  = ${frac3} y \\)<br><br>`;
    }


  
  /* ===== √âTAPE 3 : forme y = mx + p ===== */
  
const sol = solutionOfficielle();

/* --- normalisation des signes --- */
let mNum = sol.m.num;
let mDen = sol.m.den;
let pNum = sol.p.num;
let pDen = sol.p.den;

if (mDen < 0) { mNum = -mNum; mDen = -mDen; }
if (pDen < 0) { pNum = -pNum; pDen = -pDen; }

texte += `<u>√âtape 3</u> : on simplifie <br>`;

/* --- √©criture de m --- */
let mTexte = "";

if (mNum === 0) {
  mTexte = "0";
} else if (mDen === 1) {
  if (mNum === 1) mTexte = "x";
  else if (mNum === -1) mTexte = "-x";
  else mTexte = `${mNum}x`;
} else {
  mTexte = `${fractionLaTeX(mNum, mDen)}x`;
}

/* --- √©criture de p --- */
let pTexte = "";

if (pNum !== 0) {
  if (pDen === 1) {
    pTexte = pNum > 0 ? ` + ${pNum}` : ` - ${Math.abs(pNum)}`;
  } else {
    pTexte = pNum > 0
      ? ` + ${fractionLaTeX(pNum, pDen)}`
      : ` - ${fractionLaTeX(Math.abs(pNum), pDen)}`;
  }
}

/* --- affichage final --- */
texte += `\\(y = ${mTexte}${pTexte}\\)`;


  
} 
f.innerHTML = texte; 
renderMath(f);   
}
  


  

/* ====================== INIT ====================== */
genererEquation();
</script>

   
  <!-- Protection clique droit (commun √† tout le site) -->
  <script src="../../../js/protection.js"></script>
  
</body>
</html>
