<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Dancing+Script:wght@400..700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">

<!-- CSS -->
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- MathJax -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="equation"></div>

  <input type="text" id="reponse" placeholder="">

  <button onclick="verifier()">VÃ©rifier ma rÃ©ponse</button>
  <button onclick="corriger()">Correction</button>
  <button onclick="genererEquation()">Nouvel exercice</button>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
// ====================== PARAMETRES PEDAGOGIQUES ======================
// Somme = 1
const PROBA_OBLIQUE     = 0.1;   // y = mx + p
const PROBA_VERTICALE   = 0.9;  // x = k
// le reste = horizontale (y = k)

// ====================== VARIABLES ======================
let a, b, c;
let coeffA, coeffB;
let equationTextePourCorrection = "";

// ====================== UTILITAIRES ======================
function pgcd(x, y){
  while(y!==0){ let t=y; y=x%y; x=t; }
  return Math.abs(x);
}

function fractionLaTeX(num, den){
  if(num === 0) return "0";
  if(den === 1) return num.toString();
  return (num < 0 ? "-" : "") + `\\frac{${Math.abs(num)}}{${den}}`;
}

// ====================== GENERATION ======================
function randCoeff(){ return Math.floor(Math.random()*41)-20; }
function randCoeffNonZero(){ let x; do{x=randCoeff();}while(x===0); return x; }

function genererEquation(){
  const tirage = Math.random();

  if(tirage < PROBA_OBLIQUE){
    // droite oblique
    do{ a=randCoeff(); b=randCoeff(); }while(a===0 || b===0);
  }
  else if(tirage < PROBA_OBLIQUE + PROBA_VERTICALE){
    // droite verticale
    a = randCoeffNonZero();
    b = 0;
  }
  else{
    // droite horizontale
    a = 0;
    b = randCoeffNonZero();
  }

  c = randCoeff();

  // Construction texte Ã©quation (sans 1x)
  let terms=[];
  if(a !== 0){
      terms.push((a === 1 ? '' : (a === -1 ? '-' : a)) + 'x');
}
  if(b !== 0){
    let signe = (terms.length > 0 ? (b > 0 ? '+' : '-') : (b < 0 ? '-' : ''));
    let valeur = Math.abs(b) === 1 ? 'y' : Math.abs(b) + 'y';
    terms.push(signe + valeur);
}
  if(c !== 0){
    let signe = (terms.length > 0 ? (c > 0 ? '+' : '-') : (c < 0 ? '-' : ''));
    terms.push(signe + Math.abs(c));
}

let equationTextePourCorrection = terms.join(' ').replace(/\+\s-/g,'- ').replace(/^\+\s*/, '');
document.getElementById("equation").innerHTML =
    `RÃ©duis lâ€™Ã©quation de la droite : \\(${equationTextePourCorrection} = 0\\).`;

  document.getElementById("reponse").value='';
  document.getElementById("feedback").innerHTML='';

  if(b!==0){
    let p1 = pgcd(a, Math.abs(b));
    let p2 = pgcd(c, Math.abs(b));
    coeffA = {num: -a/p1, den: Math.abs(b)/p1};
    coeffB = {num: -c/p2, den: Math.abs(b)/p2};
  }

  MathJax.typeset();
}

// ====================== VERIFICATION ======================
function lireReponse(){
  return document.getElementById("reponse").value.toLowerCase().replace(/\s/g,'');
}

function verifier(){
  const r = lireReponse();
  const feedback = document.getElementById("feedback");

  if(b===0){
    let x = -c / a;
    feedback.innerHTML = (r === `x=${x}`) ? "âœ… Correct !" : "âŒ Incorrect.";
    feedback.style.color = (r === `x=${x}`) ? "green" : "red";
    return;
  }

  if(a===0){
    let y = -c / b;
    feedback.innerHTML = (r === `y=${y}`) ? "âœ… Correct !" : "âŒ Incorrect.";
    feedback.style.color = (r === `y=${y}`) ? "green" : "red";
    return;
  }

  const forme = `${fractionLaTeX(coeffA.num, coeffA.den)}x ${fractionLaTeX(coeffB.num, coeffB.den)}`;
  feedback.innerHTML = (r===forme) ? "âœ… Correct !" : "âŒ Incorrect.";
  feedback.style.color = (r===forme) ? "green" : "red";
}

// ====================== CORRECTION ======================
function corriger(){
  const f = document.getElementById("feedback");
  f.style.color = "#000"; // toujours noir

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
  // CAS VERTICAL 
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€//
  
  if (b === 0) {

  let texte = `ðŸ“˜ <strong>Correction dÃ©taillÃ©e</strong><br><br>
  \\(${equationTextePourCorrection}=0\\)<br><br>`;

  let num, den; // numÃ©rateur / dÃ©nominateur finaux


  if (a > 0) {

    texte += `Ã‰tape 2 : a > 0, on isole \\(${a}x\\) Ã  gauche :<br>
    \\(${a}x = ${-c}\\)<br><br>
    Ã‰tape 3 : on divise tout par ${a} :<br>`;

    if (c > 0) {
      // x = -|c| / a
      num = -Math.abs(c);
      den = a;
    } else {
      // x = |c| / a
      num = Math.abs(c);
      den = a;
    }

  } else {

    texte += `Ã‰tape 2 : a < 0, on isole \\(${Math.abs(a)}x\\) Ã  droite :<br>
    \\(${c} = ${Math.abs(a)}x\\)<br><br>
    Ã‰tape 3 : on divise tout par ${-a} :<br>`;

    if (c > 0) {
      // x = c / (-a)
      num = c;
      den = -a;
    } else {
      // x = -|c| / (-a)
      num = -Math.abs(c);
      den = -a;
    }
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Ã‰tape 4 : simplification
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let xFrac = fractionLaTeX(num, den);

  texte += `\\(x = ${xFrac}\\)`;

  f.innerHTML = texte;
  f.style.color = "#000";
  MathJax.typeset();
  return;
}




// ====================== INITIALISATION ======================
genererEquation();
</script>

</body>
</html>
