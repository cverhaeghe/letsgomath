<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Let's go Math !</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Dancing+Script:wght@400..700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="../../../style.css">
  <link rel="stylesheet" href="../../../exercices.css">

  <!-- Bootstrap (optionnel) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- MathJax -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="equation"></div>

  <input type="text" id="reponse" placeholder="">

  <button onclick="verifier()">V√©rifier ma r√©ponse</button>
  <button onclick="corriger()">Correction</button>
  <button onclick="genererEquation()">Nouvel exercice</button>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html"> Retour au menu</a>
  </div>
</div>

<script>
// ================= UTILITAIRES =================
function signe(num) { return num < 0 ? "-" : "+"; }
function abs(x) { return Math.abs(x); }
function pgcd(x, y) { while(y !==0){ let t=y; y=x%y; x=t;} return Math.abs(x); }

let a, b, c;
let coeffA, coeffB;

// ================= R√âGLAGES =================
const PROBA_GENERAL = 0.7;
const PROBA_VERTICAL = 0.15;
const PROBA_HORIZONTAL = 0.15;
const COEFF_MIN = -20;
const COEFF_MAX = 20;

// ================= GENERATION EQUATION =================
function genererEquation() {
  const tirage = Math.random();

  if (tirage < PROBA_GENERAL) {
    do {
      a = Math.floor(Math.random()*(COEFF_MAX-COEFF_MIN+1))+COEFF_MIN;
      b = Math.floor(Math.random()*(COEFF_MAX-COEFF_MIN+1))+COEFF_MIN;
    } while (a===0 || b===0);
  } else if (tirage < PROBA_GENERAL+PROBA_VERTICAL) {
    a = Math.floor(Math.random()*(COEFF_MAX-COEFF_MIN+1))+COEFF_MIN;
    if(a===0) a=1;
    b=0;
  } else {
    a=0;
    b = Math.floor(Math.random()*(COEFF_MAX-COEFF_MIN+1))+COEFF_MIN;
    if(b===0) b=1;
  }

  c = Math.floor(Math.random()*(COEFF_MAX-COEFF_MIN+1))+COEFF_MIN;
  if(c===0) c=1;

  // G√©n√©ration texte √©quation avec signes corrects
  let equationTexte = "";
  if(a!==0){
    equationTexte += (a===1?"":"") + (a===-1?"-":"") + "x";
  }
  if(b!==0){
    equationTexte += (equationTexte ? (b>0?" + ":" - ") : (b<0?"-":"")) + (abs(b)===1?"y":abs(b)+"y");
  }
  if(c!==0){
    equationTexte += (c>0?" + ":" - ") + abs(c);
  }
  if(equationTexte==="") equationTexte="0";

  document.getElementById("equation").innerHTML =
    `R√©duis l‚Äô√©quation de la droite : \\(${equationTexte} = 0\\).`;

  document.getElementById("reponse").value="";
  document.getElementById("feedback").innerHTML="";

  // Pr√©paration coefficients pour y = mx+p si b‚â†0
  if(b!==0){
    let p1 = pgcd(a,b);
    let p2 = pgcd(c,b);
    coeffA={num:-a/p1, den:b/p1};
    coeffB={num:-c/p2, den:b/p2};
  }

  MathJax.typeset();
}

// ================= LIRE REPONSE =================
function lireReponse(){
  return document.getElementById("reponse").value.toLowerCase().replace(/\s/g,"");
}

// ================= VERIFICATION =================
function verifier(){
  const r = lireReponse();
  const feedback = document.getElementById("feedback");

  // Cas vertical
  if(b===0){
    let p=pgcd(c,a);
    let num=-c/p, den=a/p;
    const formeSimplifiee=`x=${num}/${den}`;
    const formeNonSimplifiee=`x=${-c}/${a}`;
    if(r===formeSimplifiee){feedback.innerHTML="‚úÖ Correct !"; feedback.style.color="green";}
    else if(r===formeNonSimplifiee){feedback.innerHTML="üü† Presque‚Ä¶ fraction √† simplifier."; feedback.style.color="orange";}
    else {feedback.innerHTML="‚ùå Incorrect."; feedback.style.color="red";}
    return;
  }

  // Cas horizontal
  if(a===0){
    let p=pgcd(c,b);
    let num=-c/p, den=b/p;
    const formeSimplifiee=`y=${num}/${den}`;
    const formeNonSimplifiee=`y=${-c}/${b}`;
    if(r===formeSimplifiee){feedback.innerHTML="‚úÖ Correct !"; feedback.style.color="green";}
    else if(r===formeNonSimplifiee){feedback.innerHTML="üü† Presque‚Ä¶ fraction √† simplifier."; feedback.style.color="orange";}
    else {feedback.innerHTML="‚ùå Incorrect."; feedback.style.color="red";}
    return;
  }

  // Cas g√©n√©ral
  const formeSimplifiee = `${coeffA.num}/${coeffA.den}x${signe(coeffB.num)}${abs(coeffB.num)}/${coeffB.den}`;
  const formeNonSimplifiee = `${-a}/${b}x${-c<0?"":"+"}${-c}/${b}`;
  if(r===formeSimplifiee){feedback.innerHTML="‚úÖ Correct !"; feedback.style.color="green";}
  else if(r===formeNonSimplifiee){feedback.innerHTML="üü† Presque‚Ä¶ Les fractions doivent √™tre simplifi√©es."; feedback.style.color="orange";}
  else {feedback.innerHTML="‚ùå Incorrect."; feedback.style.color="red";}
}

// ================= CORRECTION =================
function corriger(){
  const feedback = document.getElementById("feedback");

  if(b===0){
    let p=pgcd(c,a);
    let num=-c/p, den=a/p;
    feedback.innerHTML = `üìò <strong>Correction</strong><br><br>
      \\(${a}x + ${c} = 0\\)<br><br>
      On isole x : \\(x = -\\frac{${c}}{${a}}\\)<br>
      Fraction simplifi√©e : \\(x = \\frac{${num}}{${den}}\\)`;
    feedback.style.color="#000"; MathJax.typeset(); return;
  }

  if(a===0){
    let p=pgcd(c,b);
    let num=-c/p, den=b/p;
    feedback.innerHTML = `üìò <strong>Correction</strong><br><br>
      \\(${b}y + ${c} = 0\\)<br><br>
      On isole y : \\(y = -\\frac{${c}}{${b}}\\)<br>
      Fraction simplifi√©e : \\(y = \\frac{${num}}{${den}}\\)`;
    feedback.style.color="#000"; MathJax.typeset(); return;
  }

  // Cas g√©n√©ral
  let correction = `üìò <strong>Correction d√©taill√©e</strong><br><br>
    \\(${a}x + ${b}y + ${c} = 0\\)<br><br>`;

  if(b>0){
    correction += `\\(${b}y = -${a}x - ${c}\\)<br>
                   \\(y = -\\frac{${a}}{${b}}x - \\frac{${c}}{${b}}\\)<br>
                   \\(y = \\frac{${coeffA.num}}{${coeffA.den}}x ${signe(coeffB.num)} \\frac{${abs(coeffB.num)}}{${coeffB.den}}\\)`;
  } else {
    correction += `\\(${a}x + ${c} = ${-b}y\\)<br>
                   \\(y = \\frac{${a}}{${-b}}x + \\frac{${c}}{${-b}}\\)<br>
                   \\(y = \\frac{${coeffA.num}}{${coeffA.den}}x ${signe(coeffB.num)} \\frac{${abs(coeffB.num)}}{${coeffB.den}}\\)`;
  }

  feedback.innerHTML = correction;
  feedback.style.color="#000"; MathJax.typeset();
}

// ================= INITIALISATION =================
genererEquation();
</script>

</body>
</html>
