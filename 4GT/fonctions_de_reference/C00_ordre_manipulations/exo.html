<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<!-- CSS -->
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- MathJax v3 -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>


<div class="exo-container">
  <h1>Exercice</h1>

  <div class="equation-box" id="equation"></div>


<div class="center-button">
  <button onclick="verifier()">Valider</button>
  <button onclick="corriger()">Solution</button>
  <button onclick="genererEquation()">Nouvel exercice</button>
</div>

  <div class="exo-links">
    <a href="../../4GT_geo_analytique.html">Retour au menu</a>
  </div>
</div>

<script>
/* ========================= Fonctions de référence ========================= */

const fonctions = [
  {nom:"carrée", latex:"f(x)=x^2"},
  {nom:"cube", latex:"f(x)=x^3"},
  {nom:"racine carrée", latex:"f(x)=\\sqrt{x}"},
  {nom:"racine cubique", latex:"f(x)=\\sqrt[3]{x}"},
  {nom:"valeur absolue", latex:"f(x)=|x|"},
  {nom:"inverse", latex:"f(x)=\\frac{1}{x}"}
];

  function appliquerFonction(flatex, interieur){
  if(flatex.includes("x^2"))
    return `(${interieur})^2`;

  if(flatex.includes("x^3"))
    return `(${interieur})^3`;

  if(flatex.includes("\\sqrt{x}"))
    return `\\sqrt{${interieur}}`;

  if(flatex.includes("\\sqrt[3]{x}"))
    return `\\sqrt[3]{${interieur}}`;

  if(flatex.includes("|x|"))
    return `\\left|${interieur}\\right|`;

  if(flatex.includes("\\frac{1}{x}"))
    return `\\frac{1}{${interieur}}`;
}


/* ========================= Génération fractions ========================= */

function randomChoice(arr){
  return arr[Math.floor(Math.random()*arr.length)];
}

function randomFraction(allowZero=false){
  const valeurs = [
    1,2,3,-1,-2,-3,
    1/2,-1/2,
    1/3,-1/3
  ];
  if(allowZero) valeurs.push(0);
  return randomChoice(valeurs);
}

function toLatex(n){
  if(n===0) return "0";
  if(n===1) return "1";
  if(n===-1) return "-1";
  if(Math.abs(n)===0.5) return (n<0?"-":"")+"\\frac{1}{2}";
  if(Math.abs(n)===1/3) return (n<0?"-":"")+"\\frac{1}{3}";
  return n.toString();
}


/* ========================= Génération énoncé ========================= */

let bonneReponse = [];

function genererEquation(){

  const f = randomChoice(fonctions);

  let k = randomFraction();
  let s = randomFraction();
  let h = Math.floor(Math.random()*6)-3;
  let v = Math.floor(Math.random()*6)-3;

  if(s===0) s=1;
  if(k===0) k=1;

  /* Expression latex */
let base = `x${h>=0?"-"+h:"+"+(-h)}`;
let interieur = "";

/* cas s = 1 ou -1 */
if(s === 1)
  interieur = base;

else if(s === -1)
  interieur = `-(${base})`;

/* cas fractions horizontales */
else if(s === 1/2)
  interieur = `\\frac{${base}}{2}`;

else if(s === -1/2)
  interieur = `-\\frac{${base}}{2}`;

else if(s === 1/3)
  interieur = `\\frac{${base}}{3}`;

else if(s === -1/3)
  interieur = `-\\frac{${base}}{3}`;

/* autres cas */
else
  interieur = `${toLatex(s)}(${base})`;


let fonctionTransformee = appliquerFonction(f.latex, interieur);

let expr = "";

if(k === 1){
  expr = `f(x)=${fonctionTransformee}`;
}
else if(k === -1){
  expr = `f(x)=-${fonctionTransformee}`;
}
else if(k === 1/2){
  expr = `f(x)=\\frac{${fonctionTransformee}}{2}`;
}
else if(k === -1/2){
  expr = `f(x)=-\\frac{${fonctionTransformee}}{2}`;
}
else if(k === 1/3){
  expr = `f(x)=\\frac{${fonctionTransformee}}{3}`;
}
else if(k === -1/3){
  expr = `f(x)=-\\frac{${fonctionTransformee}}{3}`;
}
else{
  expr = `f(x)=${toLatex(k)}${fonctionTransformee}`;
}

if(k === 1/2){
  expr = `f(x)=\\frac{${fonctionTransformee}}{2}`;
}
else if(k === -1/2){
  expr = `f(x)=-\\frac{${fonctionTransformee}}{2}`;
}
else if(k === 1/3){
  expr = `f(x)=\\frac{${fonctionTransformee}}{3}`;
}
else if(k === -1/3){
  expr = `f(x)=-\\frac{${fonctionTransformee}}{3}`;
}
else{
  expr = `f(x)=${toLatex(k)}\\,${fonctionTransformee}`;
}

/* translation verticale */
if(v !== 0){
  expr += v>0 ? `+${v}` : `${v}`;
}


  document.getElementById("equation").innerHTML =
    `Détermine l'ordre des transformations qu'a subit la fonction de référence :<br><br>
     \\(${expr}\\)`;

  MathJax.typeset();

  genererTransformations(k,s,h,v);
}


/* ========================= Création des transformations ========================= */

function genererTransformations(k,s,h,v){

  let liste = [];

  if(h!==0){
    liste.push(
      h>0 ?
      `Translation horizontale de ${h} vers la droite`
      :
      `Translation horizontale de ${-h} vers la gauche`
    );
  }

  if(s!==1){
    if(s>0){
      liste.push(`Dilatation horizontale de facteur ${1/Math.abs(s)}`);
    }else{
      liste.push(`Symétrie par rapport à l'axe des ordonnées`);
      liste.push(`Dilatation horizontale de facteur ${1/Math.abs(s)}`);
    }
  }

  if(k!==1){
    if(k>0){
      liste.push(`Dilatation verticale de facteur ${Math.abs(k)}`);
    }else{
      liste.push(`Symétrie par rapport à l'axe des abscisses`);
      liste.push(`Dilatation verticale de facteur ${Math.abs(k)}`);
    }
  }

  if(v!==0){
    liste.push(
      v>0 ?
      `Translation verticale de ${v} vers le haut`
      :
      `Translation verticale de ${-v} vers le bas`
    );
  }

  bonneReponse = [...liste];

  /* Mélange */
  liste.sort(()=>Math.random()-0.5);

  afficherChoix(liste);
}


/* =========================   Affichage (ordre à choisir) ========================= */

function afficherChoix(liste){
  let html = "<ol>";
  liste.forEach((t,i)=>{
    html += `<li><input type="text" id="rep${i}" placeholder="Position"> ${t}</li>`;
  });
  html += "</ol>";
  document.getElementById("feedback").innerHTML = html;
}


/* ========================= Vérification ========================= */

function verifier(){
  let correct = true;

  for(let i=0;i<bonneReponse.length;i++){
    let pos = document.getElementById("rep"+i).value;
    if(bonneReponse[pos-1] !== bonneReponse[i]){
      correct=false;
    }
  }
}


/* ========================= Solution ========================= */

function corriger(){
  let html = "<br><b>Ordre correct :</b><ol>";
  bonneReponse.forEach(t=>{
    html += `<li>${t}</li>`;
  });
  html += "</ol>";

  document.getElementById("feedback").innerHTML += html;
}


/* ======================== Génération initiale ========================= */

genererEquation();
</script>

   
  <!-- Protection clique droit (commun à tout le site) -->
  <script src="../../../js/protection.js"></script>
  
</body>
</html>
