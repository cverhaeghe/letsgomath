<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let's go Math !</title>

<!-- CSS -->
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- MathJax v3 -->
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

  <!-- GRAPHIQUE -->
<div id="graph-container"
     style="position:relative; display:flex; justify-content:center; margin-bottom:20px;">
  <svg id="graph" width="400" height="400" viewBox="0 0 400 400"></svg>
</div>

<p id="enonce"></p>
  
<div id="qcm" class="qcm-grid qcm-8"></div>

<div class="center-button">
  <button onclick="genererEquation()">Nouvel exercice</button>
</div>



  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_fonctions.html">Retour au menu</a>
  </div>
</div>

<script>
/* ====================== PARAMETRES REPERE ====================== */
const svg = document.getElementById("graph");
const width = 400, height = 400;
const unit = 40;
const xmin = -5, xmax = 5;
const ymin = -5, ymax = 5;

/* ====================== VARIABLES ====================== */
let typeEquation = "";
let dernieresFonctions = [];
let nbEssaisFaux = 0;
let typeQuestion = "racine"; // ou "oao"
let dernieresQuestions = [];

  
/* ====================== OUTILS ====================== */
function xToPx(x){ return width/2 + x*unit; }
function yToPx(y){ return height/2 - y*unit; }

  
/* ====================== REPERE ====================== */
function dessinerRepere(){
  svg.innerHTML="";

  for(let x=xmin;x<=xmax;x++){
    svg.innerHTML+=`<line x1="${xToPx(x)}" y1="0" x2="${xToPx(x)}" y2="${height}" stroke="#ddd"/>`;
  }
  for(let y=ymin;y<=ymax;y++){
    svg.innerHTML+=`<line x1="0" y1="${yToPx(y)}" x2="${width}" y2="${yToPx(y)}" stroke="#ddd"/>`;
  }

  svg.innerHTML+=`
    <line x1="0" y1="${height/2}" x2="${width}" y2="${height/2}" stroke="black" stroke-width="2"/>
    <line x1="${width/2}" y1="0" x2="${width/2}" y2="${height}" stroke="black" stroke-width="2"/>
  `;

  for(let x=xmin;x<=xmax;x++) if(x!==0)
    svg.innerHTML+=`<text x="${xToPx(x)+2}" y="${height/2+14}" font-size="12">${x}</text>`;

  for(let y=ymin;y<=ymax;y++) if(y!==0)
    svg.innerHTML+=`<text x="${width/2+6}" y="${yToPx(y)+4}" font-size="12">${y}</text>`;
}

  
function tracerPoint(a, b) {
  svg.innerHTML += `
    <circle cx="${xToPx(a)}" cy="${yToPx(b)}" r="4" fill="orange"/>
  `;
}


function tracerCourbe(fonction) {
  let path = "";
  let first = true;

  for (let x = xmin; x <= xmax; x += 0.005) {
    let y = fonction(x);

if (
  !isFinite(y) ||
  y > ymax || y < ymin
) {
  first = true;
  continue;
}


    const px = xToPx(x);
    const py = yToPx(y);

    if (first) {
      path += `M ${px} ${py}`;
      first = false;
    } else {
      path += ` L ${px} ${py}`;
    }
  }

  svg.innerHTML += `
    <path d="${path}" fill="none"
          stroke="var(--peps)"
          stroke-width="3"
          stroke-linecap="round"
          stroke-linejoin="round"/>
  `;
}



function tirerTypeFonction() {
  const types = ["quadratique","cubique","absolue"];
  return types[Math.floor(Math.random()*types.length)];
}

function tirerTypeQuestion() {
  const toutes = ["racine", "oao"];

  // On exclut la question si elle est d√©j√† sortie 2 fois de suite
  let candidates = toutes;

  if (
    dernieresQuestions.length >= 2 &&
    dernieresQuestions[0] === dernieresQuestions[1]
  ) {
    candidates = toutes.filter(q => q !== dernieresQuestions[0]);
  }

  const choix = candidates[Math.floor(Math.random() * candidates.length)];

  // Mise √† jour de l'historique
  dernieresQuestions.push(choix);
  if (dernieresQuestions.length > 2) {
    dernieresQuestions.shift();
  }

  typeQuestion = choix;
}



  function genererFonction() {

  const entiers = [-3,-2,-1,1,2,3];

  // ---------- QUADRATIQUE ----------
  if (typeEquation === "quadratique") {

    const a  = entiers[Math.floor(Math.random()*entiers.length)];
    const r1 = entiers[Math.floor(Math.random()*entiers.length)];
    const r2 = entiers[Math.floor(Math.random()*entiers.length)];

    return {
      f: x => a*(x-r1)*(x-r2),
      racines: [r1, r2],
      oao: a*r1*r2
    };
  }

  // ---------- CUBIQUE ----------
  if (typeEquation === "cubique") {

    const a = entiers[Math.floor(Math.random()*entiers.length)];
    const r = entiers[Math.floor(Math.random()*entiers.length)];

    return {
      f: x => a*(x-r)*(x*x+1),
      racines: [r],
      oao: -a*r
    };
  }

  // ---------- VALEUR ABSOLUE ----------
  if (typeEquation === "absolue") {

    const a = entiers[Math.floor(Math.random()*entiers.length)];
    const r = entiers[Math.floor(Math.random()*entiers.length)];

    // Si question RACINE ‚Üí on force b=0
    if (typeQuestion === "racine") {
      return {
        f: x => a*Math.abs(x-r),
        racines: [r],
        oao: a*Math.abs(r)
      };
    }

    // Sinon b quelconque entier
    const b = entiers[Math.floor(Math.random()*entiers.length)];

    return {
      f: x => a*Math.abs(x-r)+b,
      racines: [],
      oao: a*Math.abs(r)+b
    };
  }
}



  
function afficherQCM(propositions) {
const qcm = document.getElementById("qcm");
qcm.innerHTML = "";


let nbErreurs = 0;
let bonneCarte = null; // üëà r√©f√©rence directe


propositions.forEach(p => {
const card = document.createElement("div");
card.className = "qcm-card";
card.innerHTML = `\\(${p.label}\\)`;


// On m√©morise la bonne carte
if (p.correct) {
bonneCarte = card;
}


// üîß CORRECTION 1 ‚Äî clic sur la BONNE r√©ponse doit TOUJOURS d√©clencher l‚Äôeffet
// Remplacer ENTIEREMENT le card.onclick par ceci :

card.onclick = () => {

  // ---- BONNE R√âPONSE ----
  if (p.correct) {

    if (typeQuestion === "racine") {
      surlignerAxe(h, "x", typeEquation, ky);
    } else {
      surlignerAxe(v, "y", typeEquation, ky);
    }

    card.classList.add("correct");

    document.querySelectorAll(".qcm-card")
      .forEach(c => c.style.pointerEvents = "none");

    return;
  }

  // ---- MAUVAISE R√âPONSE ----
  card.classList.add("incorrect");
  card.style.pointerEvents = "none";
  nbErreurs++;

  // ---- 2e ERREUR : r√©v√©lation automatique ----
  if (nbErreurs >= 2 && bonneCarte) {

    bonneCarte.classList.add("correct");

    if (typeQuestion === "racine") {
      surlignerAxe(h, "x", typeEquation, ky);
    } else {
      surlignerAxe(v, "y", typeEquation, ky);
    }

    document.querySelectorAll(".qcm-card")
      .forEach(c => c.style.pointerEvents = "none");
  }
};


qcm.appendChild(card);
});


MathJax.typesetPromise();
}

  
function genererQCM(obj) {
  // exemple simple : r√©ponses enti√®res -5 ‚Üí 5
  const reponses = [];

  const bonne =
    typeQuestion === "oao"
      ? obj.oao
      : obj.racines.length > 0
        ? obj.racines[0]
        : "aucune";

  for (let i = -5; i <= 5; i++) {
    reponses.push({
      label: i,
      correct: i === bonne
    });
  }

  return reponses;
}







  
/* ====================== GENERATION ====================== */

  function genererEquation() {

  document.getElementById("feedback").innerHTML = "";

  tirerTypeQuestion();

  const enonce = document.getElementById("enonce");
  enonce.innerHTML =
    typeQuestion === "racine"
      ? "Quelles sont les √©ventuelles <strong>racines</strong> de la fonction ?"
      : "Quelle est l‚Äô<strong>ordonn√©e √† l'origine</strong> ?";

  dessinerRepere();

  // ---------- UNE SEULE FONCTION ----------
  typeEquation = tirerTypeFonction();
  const obj = genererFonction();

  tracerCourbe(obj.f);

  // ---------- QCM coh√©rent ----------
  const qcm = genererQCM(obj);
  afficherQCM(qcm);
}
  

/* ====================== VERIFICATION ====================== */

function calculerReponse(obj) {

  if (typeQuestion === "oao")
    return obj.oao;

  if (typeQuestion === "racine") {

    // si plusieurs racines ‚Üí on peut en choisir une
    if (obj.racines.length > 0)
      return obj.racines[Math.floor(Math.random()*obj.racines.length)];

    return "aucune";
  }
}


// G√©n√©rer le premier exercice au chargement
window.onload = genererEquation;
</script>
   
  <!-- Protection clique droit (commun √† tout le site) -->
  <script src="../../../js/protection.js"></script>

</body>
</html>
