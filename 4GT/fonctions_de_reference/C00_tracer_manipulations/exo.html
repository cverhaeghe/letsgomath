<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<title>Let's go Math !</title>

<!-- CSS -->
<link rel="stylesheet" href="../../../style.css">
<link rel="stylesheet" href="../../../exercices.css">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body>

<nav class="lgm-navbar">
  <ul class="nav-liste">
    <li><a href="../../../index.html">Accueil</a></li>
    <li><a href="../../../index.html#dia2">4GT</a></li>
    <li><a href="../../../index.html#dia3">5GT 6h</a></li>
    <li><a href="../../../index.html#dia4">6GT 6h</a></li>
  </ul>
</nav>

<div class="exo-container">
  <h1>Exercice</h1>

<p id="enonce"></p>

  <!-- GRAPHIQUE -->
<div id="graph-container"
     style="position:relative; display:flex; justify-content:center;">
    <svg id="graph" width="400" height="400" viewBox="0 0 400 400"></svg>
  </div>

  <div class="center-button">
    <button onclick="verifierExercice()">Valider</button>
    <button onclick="afficherCorrection()">Solution</button>
    <button onclick="nouvelExercice()">Nouvel exercice</button>
  </div>

  <p id="feedback" class="feedback"></p>

  <div class="exo-links">
    <a href="../../4GT_fonctions.html">Retour au menu</a>
  </div>
</div>

<script>
/* ================= REPERE ================= */
const svg = document.getElementById("graph");
const width=400, height=400, unit=40;
const xmin=-5,xmax=5,ymin=-5,ymax=5;

function xToPx(x){return width/2+x*unit;}
function yToPx(y){return height/2-y*unit;}

function dessinerRepere(){
svg.innerHTML="";
for(let x=xmin;x<=xmax;x++){
svg.innerHTML+=`<line x1="${xToPx(x)}" y1="0" x2="${xToPx(x)}" y2="${height}" stroke="#eee"/>`;
}
for(let y=ymin;y<=ymax;y++){
svg.innerHTML+=`<line x1="0" y1="${yToPx(y)}" x2="${width}" y2="${yToPx(y)}" stroke="#eee"/>`;
}
svg.innerHTML+=`
<line x1="0" y1="${height/2}" x2="${width}" y2="${height/2}" stroke="black"/>
<line x1="${width/2}" y1="0" x2="${width/2}" y2="${height}" stroke="black"/>`;
}

/* ================= FONCTION DE BASE ================= */
let dernierType = "";
let solutionPts = [];
let elevePts = [];

const basePoints=[
[-2,2],
[0,-1],
[1,1],
[2,-2]
];

  function tracerFonctionBase(){

  let path = "";

  basePoints.forEach((p,i)=>{
    path += (i ? "L" : "M") + ` ${xToPx(p[0])} ${yToPx(p[1])}`;
  });

  svg.innerHTML += `
    <path d="${path}" fill="none"
          stroke="black" stroke-width="3"/>
  `;

  /* Boules noires */
  basePoints.forEach(p=>{
    svg.innerHTML += `
      <circle cx="${xToPx(p[0])}"
              cy="${yToPx(p[1])}"
              r="4" fill="black"/>
    `;
  });
}



  function coefAffichage(a, variable="") {
  if (a === 1) return variable;      // 1x → x
  if (a === -1) return "-" + variable; // -1x → -x
  return a + variable;
}

  function nouvelExercice(){
  document.getElementById("feedback").innerHTML = "";
  genererExercice();
}

/* ================= TRANSFORMATIONS ================= */

let type="",h=0,k=0,s=1;

function tirerTransformation(){

  const types = ["translation","vertical","horizontal"];

  do{
    type = types[Math.floor(Math.random()*types.length)];
  }while(type === dernierType);

  dernierType = type;

  const vals = [-2,-1,1,2];

  if(type === "translation"){
    h = vals[Math.floor(Math.random()*vals.length)];
    k = vals[Math.floor(Math.random()*vals.length)];
  }

  if(type === "vertical"){
    do{
      k = vals[Math.floor(Math.random()*vals.length)];
    }while(k === 1);
  }

  if(type === "horizontal"){
    do{
      s = vals[Math.floor(Math.random()*vals.length)];
    }while(s === 1);
  }
}



function transformer([x,y]){
  if(type==="translation") return [x+h,y+k];
  if(type==="vertical") return [x,k*y];
  if(type==="horizontal") return [x/s,y];
}


  
/* ================= TRACE CORRIGE ================= */

function tracerCorrection(){
let path="";
basePoints.forEach((p,i)=>{
const [x,y]=transformer(p);
path+=(i?"L":"M")+` ${xToPx(x)} ${yToPx(y)}`;
});
svg.innerHTML+=`<path d="${path}" fill="none" stroke="red" stroke-width="3"/>`;

basePoints.forEach(p=>{
const [x,y]=transformer(p);
svg.innerHTML+=`<circle cx="${xToPx(x)}" cy="${yToPx(y)}" r="4" fill="red"/>`;
});
}

/* ================= TRACE ELEVE ================= */

svg.addEventListener("click", e => {

  if (elevePts.length >= 4) return;

  const rect = svg.getBoundingClientRect();
  let px = e.clientX - rect.left;
  let py = e.clientY - rect.top;

  let x = Math.round((px - width/2)/unit);
  let y = Math.round((height/2 - py)/unit);

  if (x<xmin||x>xmax||y<ymin||y>ymax) return;
  if (elevePts.some(p=>p[0]===x&&p[1]===y)) return;

  elevePts.push([x,y]);

  svg.innerHTML += `
    <circle cx="${xToPx(x)}" cy="${yToPx(y)}"
            r="4" fill="orange" class="eleve-point"/>
  `;
});


function effacerTrace(){
dessinerRepere();
tracerFonctionBase();
elevePts=[];
}

/* ================= GENERATION ================= */

function genererExercice(){
dessinerRepere();
tracerFonctionBase();
tirerTransformation();

solutionPts = basePoints.map(p => transformer(p));
elevePts = [];

let txt="";

if(type==="translation"){
  txt=`Trace la courbe de \\( f(x ${h>0?"-"+h:"+"+(-h)}) ${k>0?"+":"-"} ${Math.abs(k)} \\)`;
}

if(type==="vertical"){
  txt=`Trace la courbe de \\( ${coefAffichage(k,"")}f(x) \\)`;
}

if(type==="horizontal"){
  txt=`Trace la courbe de \\( f(${coefAffichage(s,"x")}) \\)`;
}

document.getElementById("enonce").innerHTML = txt;
MathJax.typesetPromise();


}
/* ================= VERIFICATION ================= */

  function verifierExercice(){

  if(elevePts.length !== 4){
    document.getElementById("feedback").innerHTML =
      "Place les 4 points avant de valider.";
    return;
  }

  let bons = 0;
  const cercles = document.querySelectorAll(".eleve-point");

  elevePts.forEach((p,i)=>{
    const correct = solutionPts.some(
      s => s[0]===p[0] && s[1]===p[1]
    );

    if(correct){
      bons++;
    }else{
      cercles[i].setAttribute("fill","red");
    }
  });

  if(bons===4){
    document.getElementById("feedback").innerHTML = "Bonne réponse !";

    /* Trace la courbe en orange */
    let path="";
    solutionPts.forEach((p,i)=>{
      path+=(i?"L":"M")+` ${xToPx(p[0])} ${yToPx(p[1])}`;
    });

    svg.innerHTML += `
      <path d="${path}" fill="none"
            stroke="orange" stroke-width="3"/>
    `;

  }else{
    document.getElementById("feedback").innerHTML =
      "Certains points sont incorrects.";
  }
}


  
function afficherCorrection(){
tracerCorrection();
}

window.onload=genererExercice;
</script>

</body>
</html>
